At IN O
the DT O
end NN O
of IN O
April NNP O
Microsoft NNP O
announced VBD O
that IN O
a DT O
vulnerability NN O
in IN O
Word NN O
was VBD O
actively RB O
being VBG O
exploited VBN O
. . O

This DT O
vulnerability NN O
occurred VBD O
in IN O
parsing VBG O
RTF NN O
files NNS O
and CC O
was VBD O
assigned VBN O
CVE-2014-1761 NN O
, , O
a DT O
thorough JJ O
analysis NN O
of IN O
which WDT O
can MD O
be VB O
found VBN O
on IN O
the DT O
HP NNP O
Security NNP O
Research NNP O
blog NN O
. . O

We PRP O
have VBP O
since RB O
seen VBN O
multiple JJ O
cases NNS O
where WRB O
this DT B-Entity
exploit VBP I-Entity
is VBZ O
used VBN O
to TO O
deliver VB B-Action
malware NN B-Entity
and CC O
one NN O
was VBD O
particularly RB O
interesting JJ O
as IN O
it PRP O
contained VBD O
a DT O
new JJ O
variant NN O
of IN O
MiniDuke FW O
( FW O
also RB O
known VBN O
as IN O
Win32/SandyEva FW O
) FW O
. . O

MiniDuke NNP O
was VBD O
first RB O
discussed VBN O
by IN O
Kaspersky NNP O
in IN O
March NNP O
2013 CD O
in IN O
their PRP$ O
paper NN O
The DT O
MiniDuke NNP O
Mystery NNP O
: : O
PDF NN O
0- CD O
day NN O
Government NNP O
Spy NNP O
Assembler NNP O
0x29A NNP O
Micro NNP O
Backdoorand NNP O
shortly RB O
after IN O
in IN O
a DT O
paper NN O
by IN O
Bitdefender NNP O
. . O

Some DT O
of IN O
the DT O
characteristics NNS O
of IN O
MiniDuke NNP B-Entity
- : O
such JJ O
as IN O
its PRP$ O
small JJ O
size NN O
( NN O
20 CD O
KB NN O
) NN O
, , O
its PRP$ O
crafty JJ O
use NN O
of IN O
assembly NN O
programming NN O
, , O
and CC O
the DT O
use NN B-Action
of IN O
zero-day JJ B-Entity
exploits NNS I-Entity
for IN B-Modifier
distribution NN B-Entity
- : O
made VBD O
it PRP O
an DT O
intriguing JJ O
threat NN O
. . O

Although IN O
the DT O
backdoor NN O
is VBZ O
still RB O
quite RB O
similar JJ O
to TO O
its PRP$ O
previous JJ O
versions NNS O
, , O
some DT O
important JJ O
changes NNS O
were VBD O
made VBN O
since IN O
last JJ O
year NN O
, , O
the DT O
most RBS O
notable JJ O
being VBG O
the DT O
introduction NN O
of IN O
a DT B-Entity
secondary JJ I-Entity
component NN I-Entity
written VBN I-Entity
in IN I-Entity
JScript NN I-Entity
to TO O
contact VB B-Action
a DT B-Entity
C NN I-Entity
& CC I-Entity
C NN I-Entity
server NN I-Entity
via IN B-Modifier
Twitter NNP B-Entity
. . O

The DT O
exploit VBP O
document NN O
was VBD O
named VBN O
Proposal-Cover-Sheet-English.rtf NN O
and CC O
is VBZ O
quite RB O
bland JJ O
when WRB O
compared VBN O
to TO O
the DT O
documents NNS O
that WDT O
were VBD O
used VBN O
in IN O
2013 CD O
, , O
which WDT O
were VBD O
of IN O
a DT O
political JJ O
nature NN O
. . O

We PRP O
received VBD O
the DT O
document NN O
on IN O
April NNP O
8th JJ O
, , O
only RB O
three CD O
days NNS O
after IN O
the DT O
compilation NN O
of IN O
the DT O
MiniDuke NNP O
payload NN O
, , O
dated VBN O
April NNP O
5th NN O
in IN O
the DT O
PE NN O
header NN O
. . O

The DT O
payload NN O
remains VBZ O
quite RB O
small JJ O
at IN O
only RB O
24 CD O
KB NN O
. . O

The DT O
functionality NN O
of IN O
the DT B-Entity
shellcode NN I-Entity
which WDT O
is VBZ B-Action
executed VBN I-Action
by IN B-Modifier
triggering VBG B-Entity
the DT I-Entity
vulnerability NN I-Entity
is VBZ O
rather RB O
simple JJ O
and CC O
straightforward JJ O
. . O

After IN O
decrypting VBG O
itself PRP O
and CC O
obtaining VBG O
the DT O
addresses NNS O
of IN O
some DT O
functions NNS O
exported VBN O
by IN O
kernel32.dll NN O
, , O
it PRP B-Entity
decrypts VBZ B-Action
and CC I-Action
drops VBZ I-Action
the DT B-Entity
payload NN I-Entity
in IN B-Modifier
the DT B-Entity
% NN I-Entity
TEMP NN I-Entity
% NN I-Entity
directory NN I-Entity
in IN I-Entity
a DT I-Entity
file NN I-Entity
named VBN I-Entity
'' '' I-Entity
a.l NN I-Entity
'' '' I-Entity
which WDT O
is VBZ B-Action
subsequently RB I-Action
loaded VBN I-Action
by IN B-Modifier
calling VBG B-Entity
kernel32 NN I-Entity
! . I-Entity
LoadLibraryA NN I-Entity
. . O

An DT O
interesting JJ O
thing NN O
about IN O
the DT O
shellcode NN O
is VBZ O
that IN O
before IN O
transferring VBG O
control NN O
to TO O
any DT O
API NNP O
function NN O
it PRP B-Entity
checks VBZ O
the DT O
first JJ O
bytes NNS O
of IN O
the DT O
function NN O
in IN O
order NN O
to TO O
detect VB B-Action
hooks NNS B-Entity
and CC I-Entity
debugger NN I-Entity
breakpoints NNS I-Entity
which WDT I-Entity
may MD I-Entity
be VB I-Entity
set VBN I-Entity
by IN I-Entity
security NN I-Entity
software NN I-Entity
and CC I-Entity
monitoring NN I-Entity
tools NNS I-Entity
. . O

If IN O
any DT O
of IN O
these DT O
are VBP O
found VBN O
the DT O
shellcode NN O
skips VBZ O
the DT O
first JJ O
5 CD O
bytes NNS O
of IN O
the DT O
function NN O
being VBG O
called VBN O
by IN O
manually RB O
executing VBG O
prologue NN O
instructions NNS O
( CD O
mov NN O
edi NN O
, , O
edi NN O
; : O
push NN O
ebp NN O
; : O
mov FW O
ebp FW O
, , O
esp FW O
) FW O
and CC O
then RB O
jumping VBG O
to TO O
the DT O
function NN O
code NN O
as IN O
illustrated VBN O
below IN O
. . O

The DT O
next JJ O
graph NN O
presents VBZ O
the DT O
execution NN O
flow NN O
of IN O
this DT O
malware NN O
when WRB O
the DT O
exploitation NN O
is VBZ O
successful JJ O
. . O

As IN O
mentioned VBN O
previously RB O
this DT O
version NN O
of IN O
the DT O
MiniDuke NNP O
payload NN O
comes VBZ O
with IN O
two CD O
modules NNS O
which WDT O
we PRP O
refer VBP O
to TO O
as IN O
the DT O
main JJ O
module NN O
and CC O
the DT O
TwitterJS NN O
module NN O
. . O

Once IN O
MiniDuke NNP O
receives VBZ O
control NN O
it PRP O
checks VBZ O
that IN O
the DT O
host NN O
process NN O
is VBZ O
not RB O
rundll32.exe NN O
and CC O
whether IN O
the DT O
current JJ O
directory NN O
is VBZ O
% NN O
TEMP NN O
% NN O
. . O

If IN O
either DT O
of IN O
those DT O
conditions NNS O
is VBZ O
met VBN O
the DT O
malware NN O
assumes VBZ O
it PRP O
is VBZ O
run VBN O
for IN O
the DT O
first JJ O
time NN O
and CC O
it PRP B-Entity
proceeds VBZ B-Action
with IN B-Modifier
its PRP$ B-Entity
installation NN I-Entity
onto IN I-Entity
the DT I-Entity
system NN I-Entity
. . O

MiniDuke NNP B-Entity
gathers VBZ B-Action
information NN B-Entity
about IN I-Entity
the DT I-Entity
system NN I-Entity
and CC O
encrypts VBZ B-Action
its PRP$ B-Entity
configuration NN I-Entity
based VBN B-Modifier
on IN I-Modifier
that DT B-Entity
information NN I-Entity
, , O
a DT O
method NN O
also RB O
used VBN O
by IN O
OSX/Flashback FW O
( FW O
this DT O
process NN O
is VBZ O
called VBN O
watermarking VBG O
by IN O
Bitdefender FW O
) FW O
. . O

The DT O
end NN O
result NN O
is VBZ O
that IN O
it PRP O
is VBZ O
impossible JJ B-Action
to TO I-Action
retrieve VB I-Action
the DT B-Entity
configuration NN I-Entity
of IN I-Entity
an DT I-Entity
encrypted JJ I-Entity
payload NN I-Entity
if IN B-Modifier
analyzing VBG B-Entity
it PRP I-Entity
on IN I-Entity
a DT I-Entity
different JJ I-Entity
computer NN I-Entity
. . O

The DT O
information NN O
collected VBN O
on IN O
infection NN O
has VBZ O
not RB O
changed VBN O
since IN O
the DT O
previous JJ O
version NN O
and CC O
consists VBZ O
of IN O
the DT O
following JJ O
values NNS O
: : O
Once RB O
the DT B-Entity
encrypted JJ I-Entity
version NN I-Entity
of IN I-Entity
the DT I-Entity
malware NN I-Entity
is VBZ B-Action
created VBN I-Action
, , O
it PRP B-Entity
is VBZ B-Action
written VBN I-Action
into IN B-Modifier
a DT B-Entity
file NN I-Entity
in IN I-Entity
the DT I-Entity
% NN I-Entity
ALLUSERSPROFILE NN I-Entity
% NN I-Entity
\Application NN I-Entity
Data NN I-Entity
directory NN I-Entity
. . O

The DT O
name NN O
of IN O
the DT O
file NN O
is VBZ O
randomly RB O
picked VBN O
from IN O
the DT O
following JJ O
values NNS O
( VBP O
you PRP O
can MD O
find VB O
this DT O
listing NN O
and CC O
those DT O
of IN O
the DT O
next JJ O
screenshots NNS O
on IN O
the DT O
VirusRadar NNP O
description NN O
: : O
The DT O
filename NN O
extension NN O
is VBZ O
also RB O
picked VBN O
randomly RB O
from IN O
the DT O
following JJ O
list NN O
: : O
To TO O
persist VB B-Action
on IN B-Modifier
the DT B-Entity
infected JJ I-Entity
system NN I-Entity
after IN B-Modifier
reboots NNS B-Entity
, , O
the DT B-Entity
malware NN I-Entity
creates VBZ B-Action
a DT B-Entity
hidden JJ I-Entity
.LNK NN I-Entity
file NN I-Entity
in IN B-Modifier
the DT B-Entity
'' '' I-Entity
Startup NNP I-Entity
'' '' I-Entity
directory NN I-Entity
pointing VBG O
to TO O
the DT O
modified VBN O
main JJ O
module NN O
. . O

The DT O
name NN O
of IN O
the DT O
.LNK NN O

file NN O
is VBZ O
randomly RB O
drawn VBN O
from IN O
the DT O
following JJ O
values NNS O
: : O
The DT B-Entity
.LNKfile NN I-Entity

is VBZ B-Action
created VBN I-Action
using VBG B-Modifier
a DT B-Entity
COM NN I-Entity
object NN I-Entity
with IN B-Modifier
the DT B-Entity
IShellLinkA NN I-Entity
interface NN I-Entity
and CC O
contains VBZ O
the DT O
following JJ O
command NN O
: : O
'' '' O
C NN O
: : O
\Windows\system32\rundll32.exe NN O
% NN O
pathtomainmodule CD O
% NN O
, , O
exportfunction NN O
'' '' O
Which WDT O
gives VBZ O
something NN O
like IN O
: : O
'' '' O
C NN O
: : O
\Windows\system32\rundll32.exe NN O
C NN O
: : O
\DOCUME~1\ALLUSE~1\APPLIC~1\data.cat NN O
, , O
IlqUenn NNP O
'' '' O
. . O

When WRB O
the DT B-Entity
malware NN I-Entity
is VBZ B-Action
loaded VBN I-Action
by IN O
rundll32.exe NN B-Entity
and CC O
the DT O
current JJ O
directory NN O
is VBZ O
n't RB O
% NN O
TEMP NN O
% NN O
, , O
the DT B-Entity
malware NN I-Entity
starts VBZ O
with IN O
gathering VBG B-Action
the DT B-Entity
same JJ I-Entity
system NN I-Entity
information NN I-Entity
as IN I-Entity
described VBN I-Entity
in IN I-Entity
the DT I-Entity
'' '' I-Entity
Installation NN I-Entity
'' '' I-Entity
section NN I-Entity
to TO B-Modifier
decrypt VB B-Entity
configuration NN I-Entity
information NN I-Entity
. . O

As IN O
with IN O
the DT O
previous JJ O
version NN O
of IN O
MiniDuke NNP O
, , O
it PRP O
checks VBZ O
for IN O
the DT O
presence NN O
of IN O
the DT O
following JJ O
processes NNS O
in IN O
the DT O
system NN O
: : O
If IN O
any DT O
of IN O
these DT O
are VBP O
found VBN O
in IN O
the DT O
system NN O
the DT O
configuration NN O
information NN O
will MD O
be VB O
decrypted VBN O
incorrectly RB O
, , O
i.e NN O
. . O

the DT O
malware NN O
will MD O
run VB O
on IN O
the DT O
system NN O
without IN O
any DT O
communication NN O
to TO O
C NN O
& CC O
C NN O
servers NNS O
. . O

If IN O
the DT O
configuration NN O
data NNS O
is VBZ O
decrypted VBN O
correctly RB O
, , O
MiniDuke NNP B-Entity
retrieves VBZ B-Action
the DT B-Entity
Twitter NNP I-Entity
page NN I-Entity
of IN I-Entity
@ SYM I-Entity
FloydLSchwartz NNP I-Entity
in IN B-Modifier
search NN B-Entity
of IN I-Entity
URLs NNS I-Entity
by IN I-Entity
which WDT I-Entity
to TO I-Entity
reach VB I-Entity
C NNP I-Entity
& CC I-Entity
C NNP I-Entity
server NN I-Entity
. . O

It PRP O
looks VBZ O
for IN O
the DT O
tag NN O
'' '' O
X NNP O
) NNP O
) NNP O
) NNP O
'' '' O
on IN O
the DT O
page NN O
( NNP O
MiniDuke NNP O
was VBD O
searching VBG O
for IN O
'' '' O
uri NN O
! . O
'' '' O
in IN O
previous JJ O
samples NNS O
) NN O
and CC O
if IN O
the DT O
tag NN O
is VBZ O
found VBN O
it PRP O
decrypts VBZ O
a DT O
URL NN O
from IN O
the DT O
data NNS O
that WDT O
follows VBZ O
it PRP O
. . O

The DT O
Twitter NNP O
account NN O
@ SYM O
FloydLSchwartz NNP O
does VBZ O
exist VB O
but CC O
has VBZ O
only JJ O
retweets NNS O
and CC O
no DT O
strings NNS O
with IN O
the DT O
special JJ O
tag NN O
. . O

As IN O
the DT O
next JJ O
step NN O
, , O
MiniDuke NNP B-Entity
gathers VBZ B-Action
the DT B-Entity
following VBG I-Entity
information NN I-Entity
from IN B-Modifier
the DT B-Entity
infected JJ I-Entity
systems NNS I-Entity
: : O
This DT B-Entity
information NN I-Entity
is VBZ B-Action
then RB I-Action
sent VBN I-Action
to TO B-Modifier
the DT B-Entity
C NN I-Entity
& CC I-Entity
C NN I-Entity
server NN I-Entity
along IN O
with IN O
the DT O
request NN B-Action
to TO B-Modifier
download VB B-Entity
a DT I-Entity
payload NN I-Entity
. . O

The DT B-Entity
final JJ I-Entity
URL NN I-Entity
used VBN B-Action
to TO B-Modifier
communicate VB B-Entity
with IN I-Entity
the DT I-Entity
C NN I-Entity
& CC I-Entity
C NN I-Entity
server NN I-Entity
looks VBZ O
like IN O
this DT O
: : O
< JJR O
urlstart NN O
> JJR O
/create.php NN O
? . O
< JJR O
rndparam NN O
> JJR O
= JJ O
< JJR O
systeminfo NN O
> JJR O
Those DT O
tokens NNS O
are VBP O
derived VBN O
as IN O
follows VBZ O
: : O
An DT O
example NN O
of IN O
such PDT O
a DT O
URL NN O
is VBZ O
given VBN O
below IN O
: : O
The DT B-Entity
payload NN I-Entity
is VBZ B-Action
downloaded VBN I-Action
in IN B-Modifier
the DT B-Entity
file NN I-Entity
named VBN I-Entity
'' '' I-Entity
fdbywu NN I-Entity
'' '' I-Entity
using VBG B-Modifier
the DT B-Entity
urlmon NN I-Entity
! . I-Entity
URLDownloadToFileA JJ I-Entity
API NN I-Entity
: : O
The DT O
downloaded VBN O
payload NN O
is VBZ O
a DT O
fake JJ O
GIF8 NN O
file NN O
containing NN O
encrypted VBD O
executable JJ O
. . O

The DT O
malware NN O
processes VBZ O
the DT O
downloaded VBN O
file NN O
in IN O
the DT O
same JJ O
way NN O
as IN O
previous JJ O
samples NNS O
of IN O
MiniDuke NNP O
: : O
it PRP B-Entity
verifies VBZ B-Action
the DT B-Entity
integrity NN I-Entity
of IN I-Entity
the DT I-Entity
file NN I-Entity
using VBG B-Modifier
RSA-2048 NN B-Entity
, , O
then RB O
decrypts VBZ O
it PRP O
, , O
stores NNS O
in IN O
a DT O
file NN O
and CC O
finally RB O
executes VBZ B-Action
it PRP B-Entity
. . O

The DT B-Entity
RSA-2048 NN I-Entity
public JJ I-Entity
key NN I-Entity
to TO O
verify VB B-Action
integrity NN B-Entity
of IN I-Entity
the DT I-Entity
executable JJ I-Entity
inside IN I-Entity
the DT I-Entity
GIF NN I-Entity
file NN I-Entity
is VBZ O
the DT O
same JJ O
as IN O
in IN O
the DT O
previous JJ O
version NN O
of IN O
MiniDuke NNP O
. . O

In IN O
the DT O
event NN O
that IN O
MiniDuke NNP O
is VBZ O
unable JJ O
to TO O
retrieve VB O
a DT O
C NN O
& CC O
C NN O
URL NN O
from IN O
this DT O
account NN O
, , O
it PRP O
generates VBZ O
a DT O
username NN O
to TO O
search VB O
for IN O
based VBN O
on IN O
the DT O
current JJ O
date NN O
. . O

The DT O
search NN O
query NN O
changes VBZ O
roughly RB O
every DT O
seven CD O
days NNS O
and CC O
is VBZ O
similar JJ O
to TO O
the DT O
backup NN O
mechanism NN O
in IN O
previous JJ O
versions NNS O
that WDT O
was VBD O
using VBG O
Google NNP O
searches NNS O
. . O

A DT O
Python NNP O
implementation NN O
of IN O
the DT O
algorithm NN O
can MD O
be VB O
found VBN O
in IN O
Appendix NN O
B NN O
. . O

The DT O
TwitterJS NN O
module NN O
is VBZ O
extracted VBN O
by IN O
creating VBG B-Action
a DT B-Entity
copy NN I-Entity
of IN I-Entity
the DT I-Entity
Windows NNP I-Entity
DLL NNP I-Entity
cryptdll.dll NNP I-Entity
, , O
injecting VBG O
a DT O
block NN O
of IN O
code NN O
into IN O
it PRP O
and CC O
redirecting VBG O
the DT O
exported VBN O
functions NNS O
to TO O
this DT O
code NN O
. . O

Here RB O
is VBZ O
how WRB O
the DT O
export NN O
address NN O
table NN O
of IN O
the DT O
patched VBN O
binary JJ O
looks NNS O
after IN O
modifications NNS O
. . O

This DT B-Entity
file NN I-Entity
is VBZ B-Action
then RB I-Action
stored VBN I-Action
in IN B-Modifier
an DT B-Entity
Alternate JJ I-Entity
Data NNP I-Entity
Stream NNP I-Entity
( NNP I-Entity
ADS NNPS I-Entity
) NNP I-Entity
in IN I-Entity
NTUSER.DAT NNP I-Entity
in IN I-Entity
the DT I-Entity
% NN I-Entity
USERPROFILE NN I-Entity
% NN I-Entity
folder NN I-Entity
. . O

Finally RB O
this DT B-Entity
DLL NNP I-Entity
is VBZ B-Action
registered VBN I-Action
as IN B-Modifier
the DT B-Entity
Open NNP I-Entity
command NN I-Entity
when WRB I-Entity
a DT I-Entity
drive NN I-Entity
is VBZ I-Entity
open JJ I-Entity
, , O
which WDT O
has VBZ O
the DT O
effect NN O
of IN O
starting VBG B-Action
the DT B-Entity
bot NN I-Entity
every DT B-Modifier
time NN I-Modifier
the DT B-Entity
user NN I-Entity
opens VBZ I-Entity
a DT I-Entity
disk NN I-Entity
drive NN I-Entity
. . O

Below IN O
you PRP O
can MD O
find VB O
the DT O
content NN O
of IN O
the DT O
init.cmd NN O
script NN O
used VBN O
by IN O
MiniDuke NNP B-Entity
to TO O
install VB B-Action
TwitterJS NN B-Entity
module NN I-Entity
onto IN B-Modifier
the DT B-Entity
system NN I-Entity
. . O

When WRB O
loaded VBN O
, , O
TwitterJS NN O
instantiates VBZ O
the DT O
JScript NN O
COM NN O
object NN O
and CC O
decrypts VBZ O
a DT O
JScript NN O
file NN O
containing VBG O
the DT O
core NN O
logic NN O
of IN O
the DT O
module NN O
. . O

Prior RB O
to TO O
executing VBG O
it PRP O
, , O
MiniDuke NNP B-Entity
applies VBZ B-Action
a DT B-Entity
light JJ I-Entity
encoding NN I-Entity
to TO B-Modifier
the DT B-Entity
script NN I-Entity
: : O
The DT O
next JJ O
images NNS O
show VBP O
the DT O
result NN O
of IN O
two CD O
separate JJ O
obfuscations NNS O
, , O
we PRP O
can MD O
see VB O
that IN O
the DT O
variables NNS O
have VBP O
different JJ O
values NNS O
. . O

This DT B-Entity
is VBZ O
probably RB O
done VBN O
to TO O
thwart VB B-Action
security NN B-Entity
systems NNS I-Entity
that WDT I-Entity
scan VBP I-Entity
at IN I-Entity
the DT I-Entity
entry NN I-Entity
points NNS I-Entity
of IN I-Entity
the DT I-Entity
JScript NN I-Entity
engine NN I-Entity
. . O

The DT O
purpose NN O
of IN O
this DT B-Entity
script NN I-Entity
is VBZ O
to TO O
use VB B-Action
Twitter NNP B-Entity
to TO B-Modifier
find VB B-Entity
a DT I-Entity
C NN I-Entity
& CC I-Entity
C NN I-Entity
and CC O
retrieve VB B-Action
JScript NN B-Entity
code NN I-Entity
to TO I-Entity
execute VB I-Entity
. . O

It PRP O
first RB O
generates VBZ O
a DT O
Twitter NNP O
user NN O
to TO O
search VB O
for IN O
; : O
this DT O
search NN O
term NN O
changes VBZ O
every DT O
7 CD O
days NNS O
and CC O
is VBZ O
actually RB O
a DT O
match NN O
to TO O
the DT O
real JJ O
account NN O
name NN O
, , O
not RB O
the DT O
Twitter NNP O
account NN O
name NN O
. . O

The DT O
bot NN O
then RB O
visits VBZ O
the DT O
Twitter NNP O
profiles NNS O
returned VBN O
by IN O
the DT O
search NN O
and CC O
looks VBZ O
for IN O
links NNS O
that WDT O
end VBP O
with IN O
'' '' O
.xhtml NN O

'' '' O
. . O

When WRB O
one CD O
is VBZ O
found VBN O
, , O
it PRP O
replaces VBZ O
'' '' O
.xhtml NN O

'' '' O
with IN O
'' '' O
.php NN O

'' '' O
and CC O
fetches VBZ O
that DT O
link NN O
. . O

Information NNP O
about IN O
the DT O
computer NN O
is VBZ O
embedded VBN O
in IN O
the DT O
Accept NNP O
HTTP NNP O
header NN O
. . O

The DT O
first JJ O
link NN O
on IN O
the DT O
retrieved VBN O
page NN O
should MD O
contain VB O
base64 NN O
data NNS O
; : O
the DT O
name NN O
attribute NN O
of IN O
the DT O
link NN O
is VBZ O
used VBN O
as IN O
a DT O
rolling JJ O
XOR NN O
key NN O
to TO O
decrypt VB O
the DT O
JScript NN O
code NN O
. . O

Finally RB O
, , O
MiniDuke NNP O
calculates VBZ O
a DT O
hash NN O
of IN O
the DT O
fetched VBN O
script NN O
and CC O
compares VBZ O
it PRP O
with IN O
a DT O
hardcoded JJ O
hash NN O
in IN O
the DT O
TwitterJS NN O
script NN O
. . O

If IN O
they PRP O
match VBP O
, , O
the DT O
fetched VBN O
script NN O
is VBZ O
executed VBN O
by IN O
calling VBG O
eval JJ O
( NNP O
) NNP O
. . O

The DT O
code NN O
hashing VBG O
algorithm NN O
used VBN O
by IN O
the DT O
component NN O
looks VBZ O
very RB O
much RB O
like IN O
SHA-1 NN O
but CC O
outputs VBZ O
different JJ O
hashes NNS O
( VBP O
you PRP O
can MD O
find VB O
the DT O
complete JJ O
implementation NN O
in IN O
Appendix NN O
B NN O
. . O

We PRP O
decided VBD O
to TO O
search VB O
for IN O
what WP O
was VBD O
changed VBN O
in IN O
the DT O
algorithm NN O
; : O
one CD O
of IN O
our PRP$ O
working VBG O
hypotheses NNS O
was VBD O
that IN O
the DT O
algorithm NN O
might MD O
have VB O
been VBN O
altered VBN O
to TO O
make VB O
collisions NNS O
feasible JJ O
. . O

We PRP O
could MD O
n't RB O
find VB O
an DT O
obvious JJ O
difference NN O
; : O
all PDT O
the DT O
constants NNS O
and CC O
the DT O
steps NNS O
of IN O
the DT O
algorithm NN O
were VBD O
as IN O
expected VBN O
. . O

Then RB O
we PRP O
noticed VBD O
that IN O
for IN O
short JJ O
messages NNS O
only RB O
the DT O
second JJ O
32-bit JJ O
word NN O
was VBD O
different JJ O
when WRB O
compared VBN O
to TO O
the DT O
original JJ O
SHA-1 NN O
. . O

By IN O
examining VBG O
how WRB O
this DT O
2nd JJ O
word NN O
was VBD O
generated VBN O
we PRP O
finally RB O
discovered VBD O
that IN O
this DT O
was VBD O
caused VBN O
by IN O
a DT O
scope NN O
issue NN O
. . O

As IN O
shown VBN O
below IN O
the DT O
SHA-1 NN O
function NN O
used VBD O
a DT O
variable NN O
named VBN O
f SYM O
: : O
the DT O
function NN O
Z NN O
( FW O
) FW O
is VBZ O
then RB O
called VBN O
which WDT O
also RB O
uses VBZ O
a DT O
variable NN O
named VBN O
f FW O
without IN O
the DT O
var FW O
keyword FW O
, , O
causing VBG O
it PRP O
to TO O
be VB O
treated VBN O
as IN O
a DT O
global JJ O
variable NN O
rather RB O
than IN O
local JJ O
to TO O
the DT O
function NN O
. . O

The DT O
end NN O
result NN O
is VBZ O
that IN O
the DT O
value NN O
of IN O
f FW O
is VBZ O
also RB O
changed VBN O
in IN O
the DT O
SHA-1 NN O
function NN O
which WDT O
affects VBZ O
the DT O
value NN O
of IN O
the DT O
2nd JJ O
word NN O
for IN O
that DT O
round NN O
and CC O
ultimately RB O
the DT O
whole JJ O
hash NN O
for IN O
long JJ O
messages NNS O
. . O

A DT O
likely JJ O
explanation NN O
of IN O
how WRB O
this DT O
problem NN O
came VBD O
to TO O
be VB O
is VBZ O
that IN O
the DT O
variable JJ O
names NNS O
were VBD O
changed VBN O
to TO O
single JJ O
letters NNS O
using VBG O
an DT O
automated JJ O
tool NN O
prior RB O
to TO O
embedding VBG O
it PRP O
in IN O
the DT O
payload NN O
. . O

The DT O
2 CD O
f LS O
variables NNS O
probably RB O
had VBD O
different JJ O
names NNS O
in IN O
the DT O
original JJ O
script NN O
which WDT O
avoided VBD O
the DT O
issue NN O
. . O

So IN O
this DT O
leaves VBZ O
us PRP O
with IN O
two CD O
takeaways NNS O
: : O
1 CD O
) CD O
The DT O
difference NN O
in IN O
the DT O
hashing VBG O
algorithm NN O
was VBD O
unintentional JJ O
and CC O
2 CD O
) NNS O
Always RB O
declare VBP O
your PRP$ O
local JJ O
variables NNS O
with IN O
the DT O
var FW O
keyword FW O
. . O

; : O
- : O
) NN O
We PRP O
generated VBD O
the DT O
list NN O
of IN O
Twitter NNP O
search NN O
terms NNS O
for IN O
2013-2014 CD O
and CC O
checked VBD O
if IN O
any DT O
of IN O
those DT O
were VBD O
registered VBN O
. . O

At IN O
the DT O
moment NN O
only RB O
one CD O
exists VBZ O
, , O
@ IN O
AA2ADcAOAA NN O
, , O
which WDT O
is VBZ O
the DT O
TwitterJS NN O
account NN O
that WDT O
was VBD O
generated VBN O
between IN O
August NNP O
21st JJ O
and CC O
27th JJ O
2013 CD O
. . O

This DT O
account NN O
has VBZ O
no DT O
tweets NNS O
. . O

In IN O
an DT O
effort NN O
to TO O
discover VB O
potential JJ O
victims NNS O
, , O
we PRP O
registered VBD O
the DT O
Twitter NNP O
accounts NNS O
corresponding VBG O
to TO O
the DT O
current JJ O
week NN O
both DT O
for IN O
the DT O
main NN O
and CC O
TwitterJS NN O
components NNS O
and CC O
set VBD O
up RP O
tweets NNS O
with IN O
encrypted JJ O
URLs NNS O
so IN O
that IN O
an DT O
infected JJ O
computer NN O
would MD O
reach VB O
out RP O
to TO O
our PRP$ O
server NN O
. . O

So RB O
far RB O
we PRP O
have VBP O
received VBN O
connections NNS O
via IN O
the DT O
TwitterJS NN O
accounts NNS O
from IN O
four CD O
computers NNS O
located JJ O
in IN O
Belgium NNP O
, , O
France NNP O
and CC O
the DT O
UK NNP O
. . O

We PRP O
have VBP O
contacted VBN O
national JJ O
CERTs NNS O
to TO O
notify VB O
the DT O
affected VBN O
parties NNS O
. . O

We PRP O
detect VBP O
the DT O
RTF NN O
exploit VBP O
document NN O
as IN O
Win32/Exploit.CVE-2014-1761.D NN O
and CC O
the DT O
MiniDuke NNP O
components NNS O
as IN O
Win32/SandyEva.G NN O
. . O

