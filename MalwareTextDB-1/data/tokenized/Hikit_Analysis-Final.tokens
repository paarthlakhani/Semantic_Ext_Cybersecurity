Hikit NNP O
consists VBZ O
of IN O
at IN B-Entity
least JJS I-Entity
two CD I-Entity
generations NNS I-Entity
of IN I-Entity
malware NN I-Entity
that WDT O
provides VBZ B-Action
basic JJ B-Entity
RAT NN I-Entity
functionality NN I-Entity
. . O

The DT B-Entity
first JJ I-Entity
generation NN I-Entity
of IN I-Entity
Hikit FW I-Entity
( FW I-Entity
referred VBN I-Entity
to TO I-Entity
as IN I-Entity
'' '' I-Entity
Gen NN I-Entity
1 CD I-Entity
'' '' I-Entity
) NN I-Entity
operates VBZ B-Action
as IN B-Modifier
a DT B-Entity
server NN I-Entity
and CC O
requires VBZ O
an DT O
externally RB O
exposed VBN O
network NN O
interface NN O
in IN O
order NN O
for IN O
an DT B-Entity
attacker NN I-Entity
to TO O
access VB B-Action
the DT B-Entity
victim NN I-Entity
machine NN I-Entity
. . O

The DT B-Entity
second JJ I-Entity
generation NN I-Entity
of IN I-Entity
Hikit FW I-Entity
( FW I-Entity
referred VBN I-Entity
to TO I-Entity
as IN I-Entity
'' '' I-Entity
Gen NN I-Entity
2 CD I-Entity
'' '' I-Entity
) NN I-Entity
uses VBZ O
the DT O
more RBR O
traditional JJ O
client NN O
model NN O
and CC O
beacons NNS B-Action
out RP B-Modifier
to TO I-Modifier
an DT B-Entity
attacker NN I-Entity
's POS I-Entity
C2 NN I-Entity
server NN I-Entity
. . O

While IN O
the DT O
communication NN O
models NNS O
shifted VBD O
dramatically RB O
between IN O
Gen NN O
1 CD O
and CC O
Gen NN O
2 CD O
, , O
both DT B-Entity
generations NNS I-Entity
of IN I-Entity
Hikit NNP I-Entity
retain VBP B-Action
the DT B-Entity
same JJ I-Entity
basic JJ I-Entity
RAT NN I-Entity
function NN I-Entity
consisting VBG I-Entity
of IN I-Entity
remote JJ I-Entity
command NN I-Entity
shell NN I-Entity
, , I-Entity
file NN I-Entity
management NN I-Entity
, , I-Entity
network NN I-Entity
proxy NN I-Entity
and CC I-Entity
port NN I-Entity
forwarding NN I-Entity
. . O

Both CC O
Gen NN O
1 CD O
and CC O
Gen NN O
2 CD O
sub-families NNS O
of IN O
Hikit NNP O
consist VBP O
of IN O
a DT B-Entity
main JJ I-Entity
DLL NNP I-Entity
( NNP I-Entity
referred VBD I-Entity
to TO I-Entity
as IN I-Entity
'' '' I-Entity
the DT I-Entity
DLL NNP I-Entity
'' '' I-Entity
) NN I-Entity
that WDT O
contains VBZ B-Action
the DT B-Entity
RAT NN I-Entity
functionality NN I-Entity
; : O
a DT O
kernel NN O
driver NN O
( NN O
referred VBN O
to TO O
as IN O
'' '' O
the DT O
Driver NN O
'' '' O
) NN O
with IN O
Gen NN O
2 CD O
also RB O
employs VBZ O
an DT O
additional JJ O
component NN O
: : O
a DT O
loader NN O
executable JJ O
. . O

The DT O
driver NN O
component NN O
of IN O
Gen NN O
1 CD O
and CC O
Gen NN O
2 CD O
are VBP O
drastically RB O
different JJ O
in IN O
their PRP$ O
operation NN O
and CC O
intent NN O
. . O

For IN O
the DT O
Gen NN O
1 CD O
sub-family NN O
of IN O
Hikit NNP O
, , O
the DT O
driver NN O
acts VBZ O
as IN O
a DT O
NDIS FW O
( FW O
network NN O
) NN O
driver NN O
that WDT O
is VBZ O
responsible JJ O
for IN O
interfacing VBG O
the DT O
DLL NNP O
to TO O
the DT O
network NN O
while IN O
preventing VBG O
a DT O
direct JJ O
WinSock NNP O
interface NN O
from IN O
occurring VBG O
. . O

The DT B-Entity
Gen NN I-Entity
1 CD I-Entity
Driver NN I-Entity
listens VBZ B-Action
to TO B-Modifier
network NN B-Entity
traffic NN I-Entity
arriving VBG I-Entity
at IN I-Entity
the DT I-Entity
local JJ I-Entity
network NN I-Entity
interface NN I-Entity
and CC O
waits VBZ O
for IN O
a DT O
specific JJ O
trigger NN O
string NN O
. . O

The DT O
trigger NN O
string NN O
varies VBZ O
by IN O
Driver NN O
and CC O
DLL NN O
sample NN O
. . O

The DT B-Entity
Gen NN I-Entity
2 CD I-Entity
Driver NN I-Entity
is VBZ O
a DT O
simpler JJR O
system NN O
driver NN O
that WDT O
acts VBZ O
as IN O
a DT O
rootkit NN O
to TO O
hide VB B-Action
processes NNS B-Entity
, , I-Entity
registry NN I-Entity
keys NNS I-Entity
and CC I-Entity
network NN I-Entity
connections NNS I-Entity
associated VBN I-Entity
with IN I-Entity
Gen NN I-Entity
2 CD I-Entity
activity NN I-Entity
on IN I-Entity
the DT I-Entity
victim NN I-Entity
's POS I-Entity
system NN I-Entity
. . O

Gen NN O
2 CD O
uses VBZ O
a DT O
standard JJ O
client-server JJ O
malware NN O
model NN O
meaning VBG O
that IN O
the DT O
malware NN O
no RB O
longer RB O
requires VBZ O
a DT O
direct JJ O
Internet-facing JJ O
network NN O
card NN O
, , O
no RB O
longer RB O
uses VBZ O
a DT O
network NN O
driver NN O
for IN O
networking NN O
, , O
and CC O
provides VBZ O
the DT O
ability NN O
to TO O
network VB O
multiple JJ O
Gen NN O
2 CD O
samples NNS O
behind IN O
a DT O
firewall NN O
with IN O
greater JJR O
ease NN O
( NN O
from IN O
the DT O
attacker's NN O
perspective NN O
) NN O
. . O

The DT O
Gen NN O
2 CD O
sub-family NN O
, , O
however RB O
, , O
no RB O
longer RB O
employs VBZ O
network NN O
stealth NN O
provided VBN O
by IN O
the DT O
Gen NN O
1 CD O
network NN O
driver NN O
which WDT O
exposes VBZ O
the DT O
C2 NN O
server NN O
addresses NNS O
to TO O
analysts NNS O
. . O

Each DT O
of IN O
the DT O
Hikit NN O
generations NNS O
contains VBZ O
multiple JJ O
sub-generations NNS O
as IN O
the DT O
author NN O
( CD O
s NN O
) NN O
of IN O
Hikit NNP O
have VBP O
evolved VBN O
their PRP$ O
code NN O
over IN O
time NN O
. . O

There EX O
is VBZ O
a DT O
noticeable JJ O
steep JJ O
improvement NN O
over IN O
the DT O
code NN O
base NN O
of IN O
Gen NN O
1 CD O
Hikit NN O
family NN O
during IN O
its PRP$ O
2011 CD O
development NN O
period NN O
. . O

The DT O
Gen NN O
2 CD O
sub-generations NNS O
share VBP O
a DT O
similar JJ O
improvement NN O
scale NN O
between IN O
late JJ O
2011 CD O
and CC O
late JJ O
2013 CD O
. . O

The DT O
earliest JJS O
known JJ O
Hikit NN O
sample NN O
dates NNS O
back RB O
to TO O
31 CD O
March NNP O
2011 CD O
. . O

Known VBN O
as IN O
the DT O
Gen NN O
1.0 CD O
sub-generation NN O
of IN O
Hikit NN O
Gen NN O
1 CD O
, , O
the DT O
first JJ O
known JJ O
sample NN O
of IN O
Hikit NN O
deviated VBN O
from IN O
the DT O
later JJ O
traditional JJ O
Gen NN O
1 CD O
model NN O
. . O

The DT O
Gen NN O
1.0 CD O
sample NN O
was VBD O
a DT O
standalone NN O
executable JJ O
whereas IN O
subsequent JJ O
Gen NN O
1 CD O
sub-generations NNS O
use VBP O
a DT O
DLL NNP O
running VBG O
as IN O
a DT O
service NN O
. . O

The DT O
Gen NN O
1.0 CD O
sample NN O
is VBZ O
clearly RB O
a DT O
work-in-progress NN O
. . O

The DT O
Gen NN O
1.0 CD O
sample NN O
, , O
while IN O
different JJ O
than IN O
subsequent JJ O
sub-generations NNS O
, , O
does VBZ O
still RB O
rely VB O
on IN O
the DT O
Driver NN O
component NN O
and CC O
for IN O
the DT O
most JJS O
part NN O
the DT O
structure NN O
of IN O
the DT O
code NN O
does VBZ O
not RB O
differ VB O
much RB O
going VBG O
forward RB O
into IN O
the DT O
Gen NN O
1 CD O
evolution NN O
. . O

Less RBR O
than IN O
three CD O
weeks NNS O
after IN O
Gen NN O
1.0 CD O
, , O
the DT O
author NN O
( CD O
s NN O
) NN O
of IN O
Hikit JJ O
move NN O
into IN O
Gen NN O
1.1 CD O
. . O

The DT O
notable JJ O
change NN O
is VBZ O
that IN O
the DT O
Hikit NNP O
model NN O
of IN O
using VBG O
a DT O
DLL NN O
and CC O
driver NN O
, , O
which WDT O
has VBZ O
remained VBN O
until IN O
present JJ O
day NN O
, , O
comes VBZ O
into IN O
being VBG O
. . O

The DT O
code NN O
matures VBZ O
slightly RB O
between IN O
Gen NN O
1.0 CD O
and CC O
Gen NN O
1.1 CD O
but CC O
the DT O
functionality NN O
does VBZ O
not RB O
change VB O
. . O

Both CC O
Gen NN O
1.0 CD O
and CC O
Gen NN O
1.1 CD O
use NN O
plaintext NN O
data NNS O
transmissions NNS O
. . O

Development NNP O
appears VBZ O
to TO O
halt VB O
on IN O
Gen NN O
1 CD O
for IN O
4 CD O
months NNS O
between IN O
20 CD O
June NNP O
2011 CD O
and CC O
23 CD O
October NNP O
2011 CD O
based VBN O
on IN O
a DT O
lack NN O
of IN O
available JJ O
samples NNS O
found VBD O
. . O

During IN O
this DT O
time NN O
the DT O
development NN O
of IN O
Hikit NNP O
appears VBZ O
to TO O
change VB O
locations NNS O
. . O

Gen NN O
1 CD O
samples NNS O
have VBP O
Program NNP O
Database NNP O
( FW O
PDB FW O
) FW O
file NN O
strings NNS O
that WDT O
identify VBP O
the DT O
file NN O
path NN O
of IN O
the DT O
Hikit NNP O
source NN O
code NN O
. . O

For IN O
Gen NN O
1.0 CD O
and CC O
Gen NN O
1.1 CD O
samples NNS O
, , O
the DT O
file NN O
path NN O
of IN O
the DT O
Hikit NNP O
source NN O
code NN O
is VBZ O
consistently RB O
h NN O
: : O
\JmVodServer\hikit NN O
. . O

Starting VBG O
with IN O
Gen NN O
1.2 CD O
, , O
the DT O
file NN O
path NN O
switches VBZ O
to TO O
e SYM O
: : O
\SourceCode\hikitnew NN O
. . O

It PRP O
is VBZ O
at IN O
this DT O
time NN O
that IN O
the DT O
functionality NN O
of IN O
Hikit NN O
Gen NN O
1 CD O
begins VBZ O
to TO O
mature VB O
. . O

In IN O
Gen NN O
1.2 CD O
, , O
the DT B-Entity
communication NN I-Entity
between IN I-Entity
the DT I-Entity
infected JJ I-Entity
machine NN I-Entity
and CC I-Entity
the DT I-Entity
attacker NN I-Entity
is VBZ B-Action
encrypted VBN I-Action
using VBG B-Modifier
an DT B-Entity
XOR NN I-Entity
mask NN I-Entity
. . O

A DT O
more RBR O
subtle JJ O
change NN O
is VBZ O
the DT O
renaming NN O
of IN O
the DT O
'' '' O
socks5 NN O
'' '' O
command NN O
to TO O
simply RB O
'' '' O
proxy NN O
'' '' O
within IN O
the DT O
code NN O
. . O

The DT O
code NN O
within IN O
Hikit NNP O
begins VBZ O
to TO O
mature VB O
but CC O
the DT O
overall JJ O
functionality NN O
does VBZ O
not RB O
expand VB O
beyond IN O
the DT O
original JJ O
set NN O
of IN O
commands NNS O
found VBN O
in IN O
Gen NN O
1.0 CD O
. . O

The DT O
other JJ O
remarkable JJ O
change NN O
within IN O
the DT O
Gen NN O
1.1 CD O
to TO O
Gen NN O
1.2 CD O
development NN O
is VBZ O
the DT O
way NN O
in IN O
which WDT O
the DT O
session NN O
handshake NN O
trigger NN O
operates VBZ O
. . O

In IN O
Gen NN O
1.0 CD O
and CC O
Gen NN O
1.1 CD O
, , O
the DT O
DLL NNP O
instructs VBZ O
the DT O
Driver NN O
to TO O
listen VB O
for IN O
a DT O
specific JJ O
string NN O
( NN O
typically RB O
a DT O
HTTP NN O
request NN O
string NN O
) NN O
and CC O
responds VBZ O
with IN O
another DT O
string NN O
. . O

In IN O
Gen NN O
1.2 CD O
, , O
the DT O
Driver NN O
has VBZ O
a DT O
hardcoded JJ O
trigger NN O
string NN O
( NN O
a DT O
specific JJ O
HTTP NN O
request NN O
string NN O
) NN O
and CC O
the DT O
DLL NNP O
instructs VBZ O
the DT O
Driver NN O
to TO O
inspect VB O
a DT O
specific JJ O
HTTP NN O
header NN O
field NN O
for IN O
a DT O
specific JJ O
hexadecimal JJ O
value NN O
. . O

This DT O
moves VBZ O
Gen NN O
1.2 CD O
into IN O
more JJR O
of IN O
a DT O
username/password JJ O
authentication NN O
scheme NN O
whereas IN O
previous JJ O
sub-generations NNS O
could MD O
potentially RB O
be VB O
accessed VBN O
by IN O
accidental JJ O
HTTP NN O
requests NNS O
. . O

At IN O
the DT O
same JJ O
time NN O
, , O
the DT O
Driver NN O
responds VBZ O
with IN O
a DT O
specific JJ O
value NN O
with IN O
in IN O
the DT O
Etag NNP O
HTTP NNP O
header NN O
field NN O
. . O

This DT O
places NNS O
Gen NN O
1.2 CD O
into IN O
a DT O
more RBR O
stealth JJ O
position NN O
as IN O
a DT O
random JJ O
, , O
non-HTTP JJ O
compliant JJ O
response NN O
from IN O
Gen NN O
1.0 CD O
and CC O
Gen NN O
1.1 CD O
samples NNS O
is VBZ O
more RBR O
obvious JJ O
than IN O
a DT O
legitimate JJ O
HTTP NN O
response NN O
with IN O
a DT O
specially RB O
crafted VBN O
Etag NN O
header NN O
. . O

Gen NN O
1.2 CD O
's POS O
development NN O
cycle NN O
appears VBZ O
to TO O
exist VB O
between IN O
23 CD O
October NNP O
2011 CD O
and CC O
2 CD O
November NNP O
2011 CD O
with IN O
several JJ O
new JJ O
samples NNS O
being VBG O
found VBN O
on IN O
the DT O
Internet NN O
having VBG O
legitimate JJ O
compile VBP O
times NNS O
during IN O
this DT O
time NN O
window NN O
. . O

There EX O
is VBZ O
, , O
however RB O
, , O
evidence NN O
that IN O
the DT O
development NN O
of IN O
Hikit NN O
Gen NN O
1 CD O
and CC O
Gen NN O
2 CD O
overlap VBP O
by IN O
several JJ O
months NNS O
. . O

The DT O
earliest JJS O
Gen NN O
2 CD O
sample NN O
known VBN O
to TO O
exist VB O
dates NNS O
to TO O
28 CD O
August NNP O
2011 CD O
, , O
two CD O
months NNS O
before IN O
the DT O
first JJ O
known JJ O
Gen NN O
1.2 CD O
sample NN O
. . O

The DT O
last JJ O
known JJ O
Gen NN O
1.2 CD O
sample NN O
, , O
and CC O
by IN O
extension NN O
, , O
the DT O
last JJ O
known JJ O
Gen NN O
1 CD O
sample NN O
, , O
dates VBZ O
to TO O
9 CD O
April NNP O
2012 CD O
. . O

The DT O
first JJ O
known JJ O
Gen NN O
2 CD O
sub-generation NN O
, , O
Gen NN O
2.0 CD O
Alpha NNP O
, , O
much RB O
like IN O
Gen NN O
1.0 CD O
, , O
represents VBZ O
an DT O
early JJ O
development NN O
version NN O
of IN O
the DT O
Gen NN O
2 CD O
Hikit NN O
sub-family NN O
. . O

Gen NN O
2.0 CD O
Alpha NN O
is VBZ O
a DT O
stand-alone JJ O
Windows NNP O
console NN O
executable NN O
that WDT O
can MD O
run VB O
as IN O
a DT O
service NN O
executable JJ O
. . O

Gen NN O
2.0 CD O
Alpha NN O
supports VBZ O
the DT O
same JJ O
commands NNS O
as IN O
Gen NN O
1.2 CD O
with IN O
an DT O
additional JJ O
command NN O
that WDT O
returns VBZ O
the DT O
infection NN O
's POS O
configuration NN O
information NN O
. . O

On IN O
9 CD O
February NNP O
2012 CD O
the DT O
first JJ O
known JJ O
sample NN O
for IN O
Gen NN O
2.0 CD O
Beta NN O
is VBZ O
compiled VBN O
by IN O
the DT O
developer NN O
( CD O
s NN O
) NN O
of IN O
Hikit NNP O
. . O

Also RB O
a DT O
stand-alone JJ O
console NN O
executable JJ O
like IN O
Gen NN O
2.0 CD O
Alpha NNP O
, , O
the DT O
Gen NN O
2.0 CD O
Beta NN O
code NN O
changes NNS O
internally RB O
without IN O
providing VBG O
significant JJ O
functionality NN O
improvements NNS O
with IN O
the DT O
exception NN O
of IN O
now RB O
the DT O
executable JJ O
uses NNS O
a DT O
device NN O
driver NN O
to TO O
hide VB O
network NN O
, , O
file NN O
, , O
and CC O
registry NN O
artifacts NNS O
related VBN O
to TO O
its PRP$ O
operation NN O
. . O

Both CC O
Gen NN O
2.0 CD O
Alpha NN O
and CC O
Gen NN O
2.0 CD O
Beta NNP O
still RB O
retain VB O
PDB NN O
file NN O
path NN O
information NN O
within IN O
their PRP$ O
binaries NNS O
. . O

During IN O
the DT O
development NN O
phase NN O
of IN O
Gen NN O
2.0 CD O
Alpha NN O
, , O
development NN O
of IN O
the DT O
Gen NN O
2.0 CD O
Alpha NN O
variants NNS O
changes NNS O
locations NNS O
. . O

First JJ O
version NN O
of IN O
the DT O
Gen NN O
2.0 CD O
Alpha NN O
malware NN O
, , O
from IN O
28 CD O
August NNP O
2011 CD O
, , O
has VBZ O
the DT O
PDB NN O
path NN O
located JJ O
in IN O
H NN O
: : O
\JmVodServer\Matrixnew2 NN O
whereas IN O
the DT O
file NN O
path NN O
for IN O
later JJ O
Gen NN O
2.0 CD O
Alpha NN O
and CC O
Gen NN O
2.0 CD O
Beta NNP O
binaries NNS O
has VBZ O
the DT O
PDB NN O
path NN O
in IN O
E NN O
: : O
\SourceCode\Matrixnew NN O
which WDT O
suggests VBZ O
that IN O
the DT O
source NN O
code NN O
for IN O
both DT O
Gen NN O
1 CD O
and CC O
Gen NN O
2 CD O
existed VBD O
on IN O
the DT O
same JJ O
machine NN O
and CC O
moved VBD O
at IN O
roughly RB O
the DT O
same JJ O
time NN O
. . O

This DT O
may MD O
indicate VB O
either CC O
a DT O
single JJ O
developer NN O
or CC O
a DT O
team NN O
( NN O
or CC O
set NN O
of IN O
teams NNS O
) VBP O
with IN O
shared JJ O
resources NNS O
. . O

The DT O
first JJ O
known JJ O
Gen NN O
2.1 CD O
binary JJ O
has VBZ O
a DT O
compile VBP O
date NN O
of IN O
17 CD O
April NNP O
2012 CD O
. . O

Gen NN O
2.1 CD O
represents VBZ O
the DT O
first JJ O
Gen NN O
2 CD O
sub-generation NN O
to TO O
use VB O
an DT O
executable-based JJ O
loader NN O
, , O
DLL NN O
and CC O
driver NN O
model NN O
, , O
a DT O
model NN O
that IN O
all DT O
subsequent JJ O
Gen NN O
2 CD O
sub-generations NNS O
employ VBP O
. . O

The DT O
functionality NN O
of IN O
the DT O
Gen NN O
2.1 CD O
sub-generation NN O
is VBZ O
the DT O
same JJ O
as IN O
the DT O
previous JJ O
generations NNS O
with IN O
no DT O
new JJ O
commands NNS O
being VBG O
introduced VBN O
. . O

Gen NN O
2.1 CD O
is VBZ O
the DT O
first JJ O
sub-generation NN O
in IN O
the DT O
Gen NN O
2 CD O
sub-family NN O
to TO O
introduce VB O
64-bit JJ O
binaries NNS O
. . O

The DT O
Gen NN O
2.2 CD O
sub-generation NN O
appears VBZ O
to TO O
have VB O
begun VBN O
on IN O
20 CD O
July NNP O
2012 CD O
. . O

Gen NN O
2.2 CD O
is VBZ O
notable JJ O
for IN O
altering VBG O
where WRB O
the DT O
configuration NN O
information NN O
of IN O
the DT O
RAT NN O
is VBZ O
stored VBN O
and CC O
using VBG O
both CC O
DLL-based JJ O
and CC O
executable- JJ O
based JJ O
loaders NNS O
. . O

Also RB O
notable JJ O
is VBZ O
the DT O
fact NN O
that IN O
the DT O
sub-generation NN O
spans VBZ O
a DT O
significant JJ O
amount NN O
of IN O
time NN O
with IN O
intermittent JJ O
periods NNS O
of IN O
development NN O
. . O

The DT O
bulk NN O
of IN O
the DT O
Gen NN O
2.2 CD O
samples NNS O
that WDT O
have VBP O
the DT O
tell-tale NN O
marks NNS O
of IN O
being VBG O
the DT O
product NN O
of IN O
a DT O
builder NN O
have VBP O
a DT O
compile VBP O
date NN O
of IN O
26 CD O
July NNP O
2013 CD O
, , O
a DT O
full JJ O
year NN O
after IN O
the DT O
first JJ O
known JJ O
Gen NN O
2.2 CD O
sample NN O
. . O

Between IN O
21 CD O
July NNP O
2012 CD O
and CC O
20 CD O
February NNP O
2013 CD O
, , O
there EX O
are VBP O
no DT O
known JJ O
Gen NN O
2.2 CD O
binaries NNS O
. . O

The DT O
two CD O
20 CD O
July NNP O
2012 CD O
samples NNS O
have VBP O
different JJ O
compile VB O
times NNS O
indicating VBG O
they PRP O
were VBD O
not RB O
the DT O
product NN O
of IN O
a DT O
builder NN O
but CC O
rather RB O
unique JJ O
compilations NNS O
. . O

Between IN O
21 CD O
February NNP O
2013 CD O
and CC O
27 CD O
February NNP O
2013 CD O
, , O
there EX O
are VBP O
4 CD O
unique JJ O
compilation NN O
dates NNS O
for IN O
the DT O
DLL NNP O
component NN O
with IN O
7 CD O
unique JJ O
, , O
known JJ O
Gen NN O
2.2 CD O
DLLs NNS O
. . O

The DT O
bulk NN O
of IN O
Gen NN O
2.2 CD O
samples NNS O
have VBP O
a DT O
compile VBP O
date NN O
of IN O
26 CD O
July NNP O
2013 CD O
. . O

There EX O
are VBP O
approximately RB O
25 CD O
known JJ O
Gen NN O
2.2 CD O
DLLs NNS O
with IN O
the DT O
26 CD O
July NNP O
2013 CD O
compile VBP O
date NN O
. . O

The DT O
Gen NN O
2.2 CD O
sub-generation NN O
appears VBZ O
to TO O
exist VB O
through IN O
at IN O
least JJS O
19 CD O
September NNP O
2013 CD O
. . O

The DT O
last JJ O
known JJ O
Gen NN O
2 CD O
sub-generation NN O
, , O
Gen NN O
2.3 CD O
, , O
began VBD O
on IN O
12 CD O
December NNP O
2013 CD O
. . O

Gen NN O
2.3 CD O
is VBZ O
notable JJ O
for IN O
its PRP$ O
use NN O
of IN O
a DT O
legitimate JJ O
SSL NN O
certificate NN O
as IN O
part NN O
of IN O
the DT O
handshake NN O
between IN O
the DT O
infected JJ O
machine NN O
and CC O
the DT O
attacker NN O
's POS O
C2 NN O
. . O

The DT B-Entity
DLL NNP I-Entity
will MD O
send VB B-Action
a DT B-Entity
legitimate JJ I-Entity
SSL NN I-Entity
certificate NN I-Entity
as IN B-Modifier
a DT B-Entity
means NN I-Entity
to TO I-Entity
disrupt VB I-Entity
heuristic NN I-Entity
IDS NNP I-Entity
sensors NNS I-Entity
that WDT I-Entity
look VBP I-Entity
for IN I-Entity
encrypted JJ I-Entity
traffic NN I-Entity
. . O

Another DT O
interesting JJ O
aspect NN O
of IN O
the DT O
Gen NN O
2.3 CD O
sub-generation NN O
is VBZ O
that IN O
there EX O
is VBZ O
no DT O
longer RBR O
a DT O
marker NN O
to TO O
designate VB O
the DT O
beginning NN O
of IN O
the DT O
embedded JJ O
configuration NN O
. . O

Gen NN O
2.1 CD O
and CC O
Gen NN O
2.2 CD O
uses VBZ O
a DT O
specific JJ O
string NN O
to TO O
indicate VB O
the DT O
beginning NN O
of IN O
the DT O
embedded JJ O
configuration NN O
presumably RB O
in IN O
order NN O
to TO O
allow VB O
the DT O
builder NN O
to TO O
locate VB O
the DT O
configuration NN O
space NN O
when WRB O
constructing VBG O
a DT O
new JJ O
configuration NN O
for IN O
the DT O
binaries NNS O
. . O

Gen NN O
2.3 CD O
, , O
however RB O
, , O
uses VBZ O
a DT O
specific JJ O
location NN O
instead RB O
, , O
requiring VBG O
the DT O
builder NN O
to TO O
calculate VB O
the DT O
specific JJ O
location NN O
using VBG O
the DT O
PE/COFF NN O
header NN O
of IN O
the DT O
binary JJ O
. . O

Also RB O
, , O
while IN O
Gen NN O
2.1 CD O
and CC O
Gen NN O
2.2 CD O
retain VBP O
the DT O
configuration NN O
within IN O
the DT O
DLL NNP O
component NN O
, , O
Gen NN O
2.3 CD O
stores NNS O
the DT O
configuration NN O
within IN O
the DT O
loader NN O
component NN O
. . O

This DT O
allows VBZ O
the DT O
attackers NNS O
to TO O
configure VB O
the DT O
loader NN O
without IN O
having VBG O
to TO O
update VB O
the DT O
DLL NNP O
. . O

The DT O
evolution NN O
of IN O
Hikit NNP O
is VBZ O
a DT O
long JJ O
and CC O
drawn VBN O
out RP O
series NN O
of IN O
small JJ O
, , O
incremental JJ O
development NN O
changes NNS O
. . O

The DT O
important JJ O
take NN O
away RB O
from IN O
the DT O
evolution NN O
of IN O
Hikit NNP O
is VBZ O
that IN O
the DT O
developers NNS O
for IN O
Gen NN O
1 CD O
appear VBP O
to TO O
have VB O
changed VBN O
in IN O
late JJ O
2011 CD O
and CC O
development NN O
of IN O
Gen NN O
2 CD O
has VBZ O
a DT O
several JJ O
month NN O
overlap VBP O
with IN O
the DT O
development NN O
and CC O
usage NN O
of IN O
Gen NN O
1 CD O
. . O

The DT O
following VBG O
table NN O
provides VBZ O
a DT O
quick JJ O
reference NN O
to TO O
the DT O
generational JJ O
( NN O
and CC O
sub-generational JJ O
) NN O
designations NNS O
of IN O
Hikit NNP O
. . O

The DT O
Driver NN O
component NN O
for IN O
Hikit NNP O
varies VBZ O
based VBN O
on IN O
the DT O
specific JJ O
Hikit JJ O
sub-family JJ O
( NN O
Gen NN O
1 CD O
or CC O
Gen NN O
2 CD O
) NN O
. . O

As IN O
such JJ O
it PRP O
is VBZ O
necessary JJ O
to TO O
describe VB O
each DT O
in IN O
the DT O
context NN O
of IN O
its PRP$ O
specific JJ O
sub-family NN O
. . O

The DT O
Driver NN O
component NN O
of IN O
Gen NN O
1 CD O
Hikit NN O
variants NNS O
provides VBZ O
the DT O
interface NN O
between IN O
the DT O
victim NN O
's POS O
network NN O
interface NN O
card NN O
( NN O
NIC NN O
) NN O
and CC O
the DT O
DLL NNP O
. . O

The DT O
Driver NN O
is VBZ O
a DT O
NDIS FW O
( FW O
network NN O
) NN O
driver NN O
that WDT O
integrates VBZ O
into IN O
the DT O
victim's NNP O
network NN O
stack VB O
. . O

The DT B-Entity
Driver NN I-Entity
intercepts VBZ B-Action
any DT B-Entity
and CC I-Entity
all DT I-Entity
network NN I-Entity
communication NN I-Entity
that WDT I-Entity
traverses VBZ I-Entity
the DT I-Entity
Windows NNP I-Entity
network NN I-Entity
stack VB I-Entity
and CC O
potentially RB O
removes VBZ O
the DT O
data NNS O
from IN O
the DT O
network NN O
stack VB O
under IN O
very RB O
specific JJ O
conditions NNS O
. . O

When WRB O
the DT O
Driver NN O
removes VBZ O
data NNS O
from IN O
the DT O
network NN O
stack VBP O
, , O
the DT O
Driver NN O
stores NNS O
the DT O
removed VBN O
data NNS O
in IN O
local JJ O
buffers NNS O
for IN O
the DT O
Gen NN O
1 CD O
DLL NN O
to TO O
query VB O
against IN O
. . O

The DT O
purpose NN O
of IN O
this DT O
behavior NN O
is VBZ O
to TO O
allow VB O
the DT B-Entity
DLL NNP I-Entity
to TO O
interact VB B-Action
with IN B-Modifier
the DT B-Entity
network NN I-Entity
without IN B-Modifier
utilizes VBZ B-Entity
the DT I-Entity
WinSock NNP I-Entity
API NNP I-Entity
which WDT I-Entity
could MD I-Entity
potentially RB I-Entity
reveal VB I-Entity
the DT I-Entity
presence NN I-Entity
of IN I-Entity
Hikit NNP I-Entity
. . O

In IN O
order NN O
to TO O
interact VB O
with IN O
the DT O
Driver NN O
, , O
the DT O
DLL NNP O
uses VBZ O
the DT O
function NN O
The DT O
Driver NN O
will MD O
remove VB O
data NNS O
from IN O
the DT O
network NN O
stack VBP O
only RB O
if IN O
a DT O
new JJ O
channel NN O
is VBZ O
being VBG O
established VBN O
. . O

A DT O
new JJ O
channel NN O
occurs VBZ O
when WRB O
the DT O
Driver NN O
detects VBZ O
a DT O
trigger NN O
string NN O
. . O

The DT O
trigger NN O
string NN O
is VBZ O
typically RB O
a DT O
short JJ O
form NN O
HTTP NN O
request NN O
with IN O
the DT O
following VBG O
trigger NN O
strings NNS O
found VBN O
in IN O
the DT O
wild JJ O
: : O
Up IN O
to TO O
and CC O
including VBG O
Gen NN O
1.1 CD O
Drivers NNS O
required VBD O
the DT O
DLL NNP O
to TO O
specify VB O
the DT O
trigger NN O
string NN O
in IN O
addition NN O
to TO O
the DT O
authentication NN O
value NN O
whereas IN O
Gen NN O
1.2 CD O
Drivers NNS O
had VBD O
the DT O
trigger NN O
strings NNS O
hardcoded VBD O
. . O

In IN O
Gen NN O
1.2 CD O
, , O
whenever WRB O
the DT O
Driver NN O
detects VBZ O
a DT O
trigger NN O
string NN O
, , O
the DT O
Driver NN O
inspects VBZ O
the DT O
rest NN O
of IN O
the DT O
data NNS O
received VBN O
for IN O
the DT O
authentication NN O
value NN O
. . O

If IN O
the DT O
token JJ O
follows VBZ O
the DT O
trigger NN O
string NN O
( NN O
there EX O
is VBZ O
no DT O
specific JJ O
limitation NN O
on IN O
how WRB O
far RB O
from IN O
the DT O
trigger NN O
string NN O
the DT O
password NN O
token JJ O
must MD O
be VB O
) CD O
, , O
then RB O
the DT O
Driver NN O
generates VBZ O
a DT O
new JJ O
channel NN O
that IN O
the DT O
DLL NNP O
will MD O
use VB O
as IN O
the DT O
conduit NN O
between IN O
the DT O
DLL NNP O
and CC O
the DT O
client NN O
. . O

The DT O
Driver NN O
appears VBZ O
to TO O
be VB O
based VBN O
off IN O
the DT O
NDIS NN O
example NN O
source NN O
code NN O
PassThru NNP O
. . O

More RBR O
specifically RB O
, , O
the DT O
author NN O
( CD O
s NN O
) NN O
of IN O
the DT O
Driver NN O
appear VBP O
to TO O
have VB O
used VBN O
the DT O
modified VBN O
version NN O
of IN O
the DT O
PassThru NNP O
example NN O
, , O
PassThruEx NN O
, , O
by IN O
James NNP O
Antognini NNP O
and CC O
Thomas NNP O
Devine JJ O
from IN O
a DT O
2003 CD O
blog NN O
post NN O
. . O

The DT B-Entity
Gen NN I-Entity
2 CD I-Entity
sub-family NN I-Entity
, , I-Entity
beginning VBG I-Entity
with IN I-Entity
Gen NN I-Entity
2.0 CD I-Entity
Beta NNP I-Entity
, , O
employs VBZ B-Action
a DT B-Entity
Windows NNP I-Entity
device NN I-Entity
driver NN I-Entity
( NN I-Entity
'' '' I-Entity
the DT I-Entity
Driver NN I-Entity
'' '' I-Entity
) NN I-Entity
to TO B-Modifier
hide VB B-Entity
aspects NNS I-Entity
of IN I-Entity
the DT I-Entity
DLL NNP I-Entity
's POS I-Entity
functionality NN I-Entity
from IN I-Entity
normal JJ I-Entity
system NN I-Entity
processes NNS I-Entity
. . O

The DT O
Driver NN O
is VBZ O
a DT O
relatively RB O
straightforward JJ O
piece NN O
of IN O
software NN O
. . O

It PRP O
does VBZ O
not RB O
attempt VB O
to TO O
obfuscate VB O
its PRP$ O
functionality NN O
from IN O
static JJ O
analysis NN O
and CC O
it PRP B-Entity
hooks VBZ B-Action
a DT B-Entity
minimum JJ I-Entity
number NN I-Entity
of IN I-Entity
kernel NN I-Entity
API NN I-Entity
functions NNS I-Entity
in IN B-Modifier
order NN I-Modifier
to TO I-Modifier
hide VB B-Entity
different JJ I-Entity
pieces NNS I-Entity
of IN I-Entity
information NN I-Entity
. . O

The DT O
Driver NN O
is VBZ O
based VBN O
primarily RB O
on IN O
the DT O
open JJ O
source NN O
Agony NN O
rootkit NN O
and CC O
it PRP O
has VBZ O
evidence NN O
of IN O
some DT O
portions NNS O
of IN O
the DT O
code NN O
coming VBG O
directly RB O
from IN O
a DT O
Chinese JJ O
blog NN O
. . O

The DT O
Driver NN O
expose VBP O
an DT O
IOCTL NN O
interface NN O
that WDT O
supports VBZ O
the DT O
following JJ O
OIDs NNS O
: : O
The DT B-Entity
Driver NN I-Entity
is VBZ O
capable JJ O
of IN O
hiding VBG B-Action
processes NNS B-Entity
( VBN O
by IN O
PID NN O
, , O
not RB O
name NN O
) NN O
, , O
system NN B-Entity
modules NNS I-Entity
, , O
services NNS B-Entity
, , O
network NN B-Entity
connections NNS I-Entity
, , O
listening VBG B-Entity
ports NNS I-Entity
, , O
directories NNS B-Entity
( NN O
and CC O
by IN O
extension NN O
, , O
files NNS B-Entity
) VBP O
, , O
as RB O
well RB O
as IN O
registry NN B-Entity
keys NNS I-Entity
and CC I-Entity
values NNS I-Entity
. . O

In IN B-Modifier
order NN I-Modifier
to TO I-Modifier
hide VB B-Entity
these DT I-Entity
items NNS I-Entity
, , O
the DT B-Entity
Driver NN I-Entity
hooks NNS B-Action
various JJ B-Entity
Windows NNP I-Entity
Kernel NNP I-Entity
API NNP I-Entity
calls VBZ I-Entity
. . O

The DT O
following VBG O
table NN O
maps VBZ O
the DT B-Entity
items NNS I-Entity
the DT B-Entity
Driver NN I-Entity
can MD O
hide VB B-Action
to TO O
the DT B-Entity
API NNP I-Entity
function NN I-Entity
that IN O
the DT B-Entity
Driver NN I-Entity
hooks NNS B-Action
: : O
In IN O
order NN O
to TO O
hide VB B-Action
services NNS B-Entity
, , O
the DT B-Entity
Driver NN I-Entity
will MD O
access VB B-Action
the DT B-Entity
memory NN I-Entity
of IN I-Entity
the DT I-Entity
services.exe NN I-Entity
process NN I-Entity
, , O
locate VBP O
the DT O
linked VBN O
list NN O
of IN O
services NNS O
and CC O
remove VB B-Action
the DT B-Entity
service NN I-Entity
entry NN I-Entity
that IN I-Entity
the DT I-Entity
Driver NN I-Entity
wishes VBZ I-Entity
to TO I-Entity
hide VB I-Entity
. . O

This DT O
is VBZ O
a DT O
surprisingly RB O
invasive JJ O
method NN O
to TO O
obfuscate VB B-Action
a DT B-Entity
process NN I-Entity
. . O

Upon IN O
activation NN O
, , O
the DT B-Entity
Driver NN I-Entity
will MD O
expose VB O
its PRP$ O
interface NN O
by IN O
calling VBG B-Action
IoCreateDevice NNP B-Entity
with IN B-Modifier
the DT B-Entity
name NN I-Entity
\Device\agony FW I-Entity
( FW I-Entity
for IN I-Entity
Gen NN I-Entity
2.0 CD I-Entity
Beta NNP I-Entity
samples NNS I-Entity
) NN I-Entity
, , I-Entity
\Device\HTTPS NN I-Entity
( NN I-Entity
for IN I-Entity
Gen NN I-Entity
2.1 CD I-Entity
samples NNS I-Entity
) NN I-Entity
, , I-Entity
\Device\advcachemgr NN I-Entity
( NN I-Entity
for IN I-Entity
Gen NN I-Entity
2.2 CD I-Entity
samples NNS I-Entity
) CD I-Entity
or CC I-Entity
\Device\diskdump FW I-Entity
( FW I-Entity
for IN I-Entity
Gen NN I-Entity
2.3 CD I-Entity
samples NNS I-Entity
) NN I-Entity
. . O

The DT B-Entity
Driver NN I-Entity
also RB O
creates VBZ B-Action
a DT B-Entity
symbolic JJ I-Entity
link NN I-Entity
to TO B-Modifier
the DT B-Entity
device NN I-Entity
using VBG B-Modifier
the DT B-Entity
same JJ I-Entity
name NN I-Entity
but CC I-Entity
under IN I-Entity
the DT I-Entity
\DosDevices\ NN I-Entity
tree NN I-Entity
. . O

For IN O
reasons NNS O
unknown JJ O
, , O
the DT O
authors NNS O
of IN O
the DT O
Driver NN O
used VBD O
code NN O
from IN O
a DT O
Chinese JJ O
blog NN O
that IN O
details NNS O
how WRB O
to TO O
hide VB O
network NN O
connections NNS O
on IN O
Windows NNP O
Vista NNP O
and CC O
later RB O
decided VBD O
to TO O
keep VB O
the DT O
example NN O
IP NNP O
address NN O
within IN O
the DT O
code NN O
. . O

The DT B-Entity
Hikit NNP I-Entity
family NN I-Entity
has VBZ O
supported VBN B-Action
roughly RB B-Entity
the DT I-Entity
same JJ I-Entity
set NN I-Entity
of IN I-Entity
commands NNS I-Entity
since IN B-Modifier
the DT B-Entity
first JJ I-Entity
known JJ I-Entity
samples NNS I-Entity
of IN I-Entity
Gen NN I-Entity
1.0 CD I-Entity
. . O

Gen NN O
2.0 CD O
introduced VBD O
a DT O
single JJ O
command NN O
to TO O
provide VB O
insight NN O
into IN O
an DT O
infected JJ O
machine NN O
's POS O
Hikit JJ O
configuration NN O
( NN O
something NN O
that WDT O
is VBZ O
not RB O
necessary JJ O
for IN O
Gen NN O
1 CD O
variants NNS O
since IN O
they PRP O
are VBP O
server-based JJ O
) NN O
. . O

The DT B-Entity
RAT NN I-Entity
supports VBZ B-Action
the DT B-Entity
following JJ I-Entity
commands NNS I-Entity
: : O
The DT B-Entity
shell NN I-Entity
command NN I-Entity
activates VBZ B-Action
a DT B-Entity
remote JJ I-Entity
shell NN I-Entity
on IN B-Modifier
the DT B-Entity
victim NN I-Entity
's POS I-Entity
computer NN I-Entity
. . O

The DT O
remote JJ O
shell NN O
function NN O
uses VBZ O
the DT O
standard JJ O
pipe NN O
redirection NN O
method NN O
for IN O
interfacing VBG O
a DT O
network NN O
application NN O
( NN O
in IN O
this DT O
case NN O
, , O
the DT O
DLL NNP O
) CD O
to TO O
a DT O
hidden JJ O
command NN O
shell NN O
. . O

The DT B-Entity
file NN I-Entity
command NN I-Entity
provides VBZ O
an DT O
attacker NN O
with IN O
a DT O
variety NN O
of IN O
disk NN O
access NN O
options NNS O
such JJ O
as IN O
listing NN B-Action
directories NNS B-Entity
, , O
changing VBG O
the DT O
current JJ O
directory NN O
, , O
and CC O
uploading VBG B-Action
and CC O
downloading VBG B-Action
files NNS B-Entity
. . O

The DT O
connect VBP O
function NN O
provides VBZ O
the DT O
functionality NN O
to TO O
allow VB O
one CD O
Hikit NNP O
DLL NNP O
to TO O
interface NN O
with IN O
another DT O
DLL NNP O
of IN O
a DT O
similar JJ O
version NN O
. . O

The DT O
use NN O
of IN O
this DT O
functionality NN O
can MD O
best RB O
be VB O
illustrated VBN O
by IN O
considering VBG O
the DT O
fact NN O
that IN O
the DT O
Gen NN O
1 CD O
Driver NN O
requires VBZ O
an DT O
exposed JJ O
network NN O
interface NN O
in IN O
order NN O
for IN O
an DT O
external JJ O
attacker NN O
to TO O
access VB O
the DT O
Gen NN O
1 CD O
's POS O
RAT NN O
function NN O
. . O

This DT O
would MD O
prohibit VB O
lateral JJ O
movement NN O
within IN O
a DT O
victim NN O
's POS O
network NN O
as IN O
the DT O
bulk NN O
of IN O
any DT O
organization NN O
's POS O
network NN O
infrastructure NN O
is VBZ O
not RB O
directly RB O
exposed VBN O
to TO O
the DT O
Internet NNP O
. . O

By IN O
using VBG O
the DT O
connect VB O
command NN O
, , O
an DT O
attacker NN O
can MD O
instruct VB O
the DT O
externally RB O
exposed VBN O
Gen NN O
1 CD O
DLL NN O
to TO O
route NN O
traffic NN O
to TO O
a DT O
Gen NN O
1 CD O
DLL NN O
that WDT O
is VBZ O
behind IN O
the DT O
firewall NN O
, , O
effectively RB O
making VBG O
the DT O
externally RB O
exposed VBN O
Gen NN O
1 CD O
DLL NN O
a DT O
local JJ O
router NN O
for IN O
Hikit NNP O
traffic NN O
. . O

The DT O
proxy JJ O
( NN O
or CC O
socks5 FW O
) FW O
command NN O
allows VBZ O
an DT B-Entity
attacker NN I-Entity
to TO O
utilize VB B-Action
a DT B-Entity
Hikit-infected JJ I-Entity
machine NN I-Entity
as IN B-Modifier
a DT B-Entity
proxy NN I-Entity
. . O

Gen NN B-Entity
2 CD I-Entity
samples NNS I-Entity
rely VBP B-Action
on IN B-Modifier
a DT B-Entity
configuration NN I-Entity
in IN B-Modifier
order NN I-Modifier
to TO I-Modifier
know VB B-Entity
where WRB I-Entity
the DT I-Entity
C2 NN I-Entity
server NN I-Entity
exists VBZ I-Entity
along IN O
with IN O
other JJ O
operational JJ O
aspects NNS O
such JJ O
as IN O
the DT O
name NN O
of IN O
its PRP$ O
service NN O
and CC O
operational JJ O
times NNS O
. . O

This DT O
information NN O
is VBZ O
important JJ O
for IN O
the DT O
attacker NN O
to TO O
have VB O
access NN O
to TO O
in IN O
order NN O
to TO O
determine VB O
if IN O
any DT O
aspect NN O
of IN O
the DT O
configuration NN O
is VBZ O
out IN O
of IN O
date NN O
( NN O
thus RB O
requiring VBG O
a DT O
new JJ O
variant NN O
of IN O
the DT O
Gen NN O
2 CD O
binary JJ O
to TO O
be VB O
configured VBN O
and CC O
deployed VBN O
) NN O
. . O

The DT O
information NN O
command NN O
returns VBZ O
to TO O
the DT O
attacker NN O
the DT O
complete JJ O
configuration NN O
and CC O
current JJ O
state NN O
of IN O
the DT O
Gen NN O
2 CD O
malware NN O
. . O

As IN O
the DT O
name NN O
implies VBZ O
, , O
the DT O
exit NN O
command NN O
causes VBZ O
the DT O
DLL NNP O
to TO O
discontinue VB O
the DT O
current JJ O
connection NN O
. . O

With IN O
the DT O
Gen NN O
1 CD O
sub-family NN O
using VBG O
a DT O
server NN O
model NN O
and CC O
the DT O
Gen NN O
2 CD O
sub-family NN O
using VBG O
the DT O
client NN O
model NN O
, , O
understanding VBG O
how WRB O
each DT O
of IN O
the DT O
DLL NNP O
components NNS O
of IN O
the DT O
sub-families JJ O
works NNS O
is VBZ O
best RB O
done VBN O
, , O
as IN O
with IN O
the DT O
Driver NN O
above IN O
, , O
in IN O
the DT O
context NN O
of IN O
the DT O
specific JJ O
sub-family NN O
. . O

As IN O
noted VBN O
previously RB O
in IN O
this DT O
report NN O
, , O
the DT O
Gen NN O
1 CD O
sub-family NN O
has VBZ O
several JJ O
sub-generations NNS O
but CC O
overall RB O
the DT O
functionality NN O
of IN O
the DT O
Gen NN O
1 CD O
sub-family NN O
has VBZ O
remained VBN O
constant JJ O
. . O

With IN O
the DT O
exception NN O
of IN O
Gen NN O
1.0 CD O
, , O
the DT O
functionality NN O
of IN O
Gen NN O
1 CD O
comes VBZ O
from IN O
the DT O
DLL NNP O
component NN O
( NN O
Gen NN O
1.0 CD O
uses VBZ O
a DT O
stand-alone JJ O
executable JJ O
to TO O
achieve VB O
the DT O
same JJ O
results NNS O
) VBP O
. . O

The DT O
DLL NNP O
operates VBZ O
as IN O
a DT O
service NN O
, , O
requiring VBG O
an DT B-Entity
attacker NN I-Entity
is VBZ B-Action
install VB I-Action
the DT B-Entity
DLL NNP I-Entity
as IN B-Modifier
a DT B-Entity
service NN I-Entity
at IN B-Modifier
some DT B-Entity
point NN I-Entity
prior RB I-Entity
to TO I-Entity
activation NN I-Entity
. . O

The DT O
DLL NNP O
contains VBZ O
only RB O
two CD O
exports NNS O
: : O
DllEntryPoint NNP O
and CC O
DllRegisterServer NNP O
. . O

Ultimately RB O
, , O
both DT B-Entity
exports NNS I-Entity
generate VBP B-Action
a DT B-Entity
new JJ I-Entity
thread NN I-Entity
of IN I-Entity
the DT I-Entity
same JJ I-Entity
function NN I-Entity
( NN I-Entity
'' '' I-Entity
mainThread NN I-Entity
'' '' I-Entity
) NN I-Entity
. . O

The DT O
difference NN O
between IN O
the DT O
two CD O
exports NNS O
is VBZ O
that IN O
DllRegisterServer NNP O
can MD O
take VB O
an DT O
optional JJ O
command NN O
line NN O
argument NN O
of IN O
the DT O
letter NN O
'' '' O
u NN O
'' '' O
which WDT O
will MD O
instruct VB O
the DT B-Entity
main JJ I-Entity
thread NN I-Entity
to TO O
uninstall VB B-Action
the DT B-Entity
Gen NN I-Entity
1 CD I-Entity
system NN I-Entity
from IN B-Modifier
a DT B-Entity
victim NN I-Entity
's POS I-Entity
computer NN I-Entity
. . O

If IN O
the DT O
uninstall JJ O
argument NN O
exists VBZ O
, , O
mainThread NN B-Entity
will MD O
simply RB O
remove VB B-Action
the DT B-Entity
Driver NN I-Entity
from IN B-Modifier
the DT B-Entity
victim NN I-Entity
's POS I-Entity
machine NN I-Entity
and CC O
terminate VB O
. . O

The DT O
authors NNS O
of IN O
Gen NN O
1 CD O
used VBD O
freely RB O
available JJ O
source NN O
code NN O
found VBD O
online NN O
for IN O
their PRP$ O
removal NN O
function NN O
. . O

When WRB O
the DT O
DLL NNP O
activates VBZ O
, , O
either CC O
by IN O
a DT O
call NN O
to TO O
DllEntryPoint NN O
or CC O
by IN O
calling VBG B-Action
DllRegisterServer NNP B-Entity
without IN B-Modifier
the DT B-Entity
u NN I-Entity
parameter NN I-Entity
, , O
mainThread NN O
begins VBZ O
by IN O
verifying VBG O
the DT O
version NN O
of IN O
the DT O
Driver NN O
installed VBN O
on IN O
the DT O
victim NN O
's POS O
machine NN O
. . O

This DT O
requires VBZ O
sending VBG O
OID NN O
0x12C850 NN O
to TO O
the DT O
Driver NN O
and CC O
comparing VBG O
the DT O
resulting VBG O
32-bit JJ O
value NN O
with IN O
the DT O
required JJ O
driver NN O
version NN O
. . O

If IN O
the DT O
version NN O
is VBZ O
incorrect JJ O
( FW O
i.e FW O
. . O

it PRP O
does VBZ O
n't RB O
match VB O
the DT O
specified VBN O
version NN O
) NN O
, , O
the DT B-Entity
DLL NNP I-Entity
installs VBZ B-Action
the DT B-Entity
version NN I-Entity
of IN I-Entity
the DT I-Entity
Driver NN I-Entity
found VBN I-Entity
within IN I-Entity
the DT I-Entity
DLL NNP I-Entity
's POS I-Entity
resource NN I-Entity
section NN I-Entity
( NN I-Entity
under IN I-Entity
the DT I-Entity
BIN NNP I-Entity
resource NN I-Entity
tree NN I-Entity
) NN I-Entity
. . O

With IN O
the DT O
Driver NN O
version NN O
verified VBD O
( CD O
or CC O
forcibly RB O
corrected VBN O
by IN O
installing VBG B-Action
the DT B-Entity
appropriate JJ I-Entity
Driver NN I-Entity
) NN O
, , O
the DT O
DLL NNP O
will MD O
instruct VB O
the DT O
Driver NN O
to TO O
use VB O
a DT O
specified JJ O
string NN O
( NN O
for IN O
Gen NN O
1.0 CD O
and CC O
Gen NN O
1.1 CD O
samples NNS O
) CD O
or CC O
a DT O
DWORD FW O
( FW O
for IN O
Gen NN O
1.2 CD O
samples NNS O
) CD O
as IN O
the DT O
acknowledgment NN O
value NN O
to TO O
send VB O
to TO O
a DT O
connecting VBG O
client NN O
who WP O
requests NNS O
the DT O
appropriate JJ O
URL NN O
. . O

The DT O
DLL NNP O
again RB O
checks VBZ O
the DT O
version NN O
of IN O
the DT O
Driver NN O
and CC O
, , O
in IN O
some DT O
versions NNS O
of IN O
the DT O
DLL NNP O
, , O
will MD O
print VB O
a DT O
message NN O
indicating VBG O
the DT O
version NN O
of IN O
the DT O
Driver NN O
installed VBN O
and CC O
report VBP O
the DT O
'' '' O
Transate NN O
version NN O
'' '' O
( CD O
the DT O
word NN O
translate VB O
is VBZ O
misspelled VBN O
within IN O
the DT O
binary JJ O
) NN O
. . O

It PRP O
appears VBZ O
that IN O
the DT O
Driver NN O
and CC O
the DT O
communication NN O
protocol NN O
version NN O
do VBP O
not RB O
necessarily RB O
have VB O
to TO O
match VB O
exactly RB O
, , O
allowing VBG O
the DT O
possibility NN O
that IN O
the DT O
Driver NN O
and CC O
the DT O
DLL NNP O
could MD O
be VB O
compiled VBN O
at IN O
separate JJ O
times NNS O
. . O

If IN O
the DT O
Driver NN O
version NN O
is VBZ O
less JJR O
than IN O
the DT O
'' '' O
Transate NNP O
'' '' O
version NN O
( NN O
indicating VBG O
that IN O
the DT O
Driver NN O
is VBZ O
a DT O
version NN O
too RB O
old JJ O
to TO O
support VB O
the DT O
necessary JJ O
communication NN O
protocols NNS O
) CD O
, , O
the DT O
DLL NNP O
will MD O
, , O
in IN O
some DT O
version NN O
of IN O
the DT O
DLL NNP O
, , O
print VB O
out RP O
a DT O
line NN O
to TO O
the DT O
screen NN O
indicating VBG O
the DT O
DRIVERMINVERSION NN O
required VBN O
along IN O
with IN O
the DT O
current JJ O
Driver NN O
version NN O
. . O

Following VBG O
this DT O
, , O
the DT B-Entity
DLL NNP I-Entity
will MD O
then RB O
attempt VB O
to TO O
install VB B-Action
the DT B-Entity
correct JJ I-Entity
version NN I-Entity
of IN I-Entity
the DT I-Entity
Driver NN I-Entity
prior RB B-Modifier
to TO I-Modifier
terminating VBG B-Entity
. . O

It PRP O
is VBZ O
unclear JJ O
why WRB O
this DT O
code NN O
exists VBZ O
given VBN O
that IN O
the DT O
DLL NNP O
will MD O
check VB O
the DT O
Driver NN O
version NN O
and CC O
correct VB O
the DT O
Driver NN O
if IN O
necessary JJ O
prior RB O
to TO O
reaching VBG O
the DT O
portion NN O
of IN O
the DT O
code NN O
that WDT O
reports VBZ O
the DT O
DRIVERMINVERSION NNP O
. . O

It PRP O
is VBZ O
possible JJ O
that IN O
the DT B-Entity
second JJ I-Entity
Driver NN I-Entity
version NN I-Entity
check NN I-Entity
is VBZ O
a DT O
last JJ O
ditch NN O
effort NN O
to TO O
ensure VB B-Action
the DT B-Entity
correct JJ I-Entity
Driver NN I-Entity
is VBZ I-Entity
installed VBN I-Entity
. . O

The DT O
DLL NNP O
enters VBZ O
an DT O
infinite JJ O
loop NN O
where WRB O
the DT O
DLL NNP O
waits VBZ O
for IN O
the DT O
Driver NN O
to TO O
report VB O
a DT O
new JJ O
channel NN O
exists VBZ O
. . O

A DT O
channel NN O
represents VBZ O
an DT O
established JJ O
connection NN O
between IN O
the DT O
Driver NN O
and CC O
an DT O
external JJ O
party NN O
that WDT O
has VBZ O
provided VBN O
the DT O
proper JJ O
initial JJ O
request NN O
and CC O
, , O
for IN O
Gen NN O
1.2 CD O
variants NNS O
, , O
provided VBD O
the DT O
proper JJ O
authentication NN O
value NN O
. . O

When WRB O
the DT O
Driver NN O
establishes VBZ O
a DT O
new JJ O
channel NN O
, , O
the DT B-Entity
DLL NNP I-Entity
generates VBZ O
a DT O
runtime NN O
data NN O
structure NN O
before IN O
generating VBG B-Action
a DT B-Entity
new JJ I-Entity
thread NN I-Entity
( NN I-Entity
'' '' I-Entity
HikitThreadFunc NNP I-Entity
'' '' I-Entity
) NN I-Entity
which WDT I-Entity
will MD I-Entity
service VB I-Entity
any DT I-Entity
request NN I-Entity
coming VBG I-Entity
from IN I-Entity
the DT I-Entity
new JJ I-Entity
channel NN I-Entity
. . O

This DT O
allows VBZ O
the DT O
DLL NNP O
to TO O
service VB O
multiple JJ O
channels NNS O
at IN O
one CD O
time NN O
. . O

The DT O
HikitThreadFunc NNP O
function NN O
is VBZ O
, , O
at IN O
its PRP$ O
core NN O
, , O
a DT O
simple JJ O
wait NN O
and CC O
respond NN O
loop NN O
. . O

The DT O
function NN O
begins VBZ O
by IN O
transmitting VBG O
a DT O
Hikit JJ O
command NN O
prompt JJ O
to TO O
the DT O
client NN O
( FW O
Hikit FW O
> JJR O
) NN O
before IN O
settling VBG O
into IN O
an DT O
infinite JJ O
loop NN O
of IN O
The DT O
communication NN O
scheme NN O
between IN O
the DT O
DLL NNP O
and CC O
the DT O
client NN O
consists VBZ O
of IN O
a DT O
20 CD O
to TO O
24 CD O
byte NN O
header NN O
( NN O
for IN O
Gen NN O
1.0 CD O
and CC O
Gen NN O
1.1 CD O
) NN O
or CC O
a DT O
28 CD O
byte NN O
header NN O
( NN O
for IN O
Gen NN O
1.2 CD O
) NN O
followed VBN O
by IN O
an DT O
optional JJ O
payload NN O
. . O

The DT O
format NN O
of IN O
the DT O
Gen NN O
1.0 CD O
and CC O
Gen NN O
1.1 CD O
header NN O
is VBZ O
as IN O
follows VBZ O
: : O
While IN O
the DT O
Gen NN O
1.2 CD O
header NN O
is VBZ O
: : O
For IN O
Gen NN O
1.0 CD O
and CC O
Gen NN O
1.1 CD O
samples NNS O
, , O
the DT O
magic JJ O
field NN O
contains VBZ O
the DT O
string NN O
'' '' O
.. FW O

.. FW O

'' '' O
( CD O
two CD O
dots NNS O
followed VBN O
by IN O
a DT O
space NN O
then RB O
two CD O
more JJR O
dots NNS O
) VBP O
. . O

Whereas IN O
the DT O
key JJ O
field NN O
in IN O
Gen NN O
1.2 CD O
samples NNS O
contains VBZ O
a DT O
32-bit JJ O
value NN O
that WDT O
represents VBZ O
the DT O
XOR NNP O
key NN O
for IN O
the DT O
remainder NN O
of IN O
the DT O
PacketHeader NNP O
and CC O
any DT O
additional JJ O
payload NN O
data NNS O
. . O

The DT O
XOR NN O
scheme NN O
works VBZ O
on IN O
32-bit JJ O
chunks NNS O
of IN O
data NNS O
where WRB O
each DT O
32-bit JJ O
chunk NN O
of IN O
data NNS O
is VBZ O
XOR NNP O
'd NNP O
against IN O
the DT O
key JJ O
value NN O
. . O

Version NN O
checking NN O
is VBZ O
important JJ O
in IN O
all DT O
Gen NN O
1 CD O
variants NNS O
. . O

The DT B-Entity
dwHikitVersion NN I-Entity
field NN I-Entity
allows VBZ B-Action
the DT B-Entity
client NN I-Entity
and CC I-Entity
the DT I-Entity
DLL NNP I-Entity
to TO B-Modifier
ensure VB B-Entity
that IN I-Entity
they PRP I-Entity
have VBP I-Entity
a DT I-Entity
compatible JJ I-Entity
communication NN I-Entity
scheme NN I-Entity
in IN I-Entity
place NN I-Entity
prior RB B-Modifier
to TO I-Modifier
executing VBG B-Entity
commands NNS I-Entity
. . O

Gen NN O
1 CD O
samples NNS O
have VBP O
a DT O
particular JJ O
interest NN O
in IN O
the DT O
victim NN O
's POS O
locale NN O
language NN O
preferences NNS O
. . O

While IN O
it PRP O
is VBZ O
typical JJ O
for IN O
most JJS O
RATs NNS O
that WDT O
provide VBP O
remote JJ O
shells NNS O
to TO O
simply RB O
pass VB O
data NNS O
unfiltered JJ O
from IN O
client NN O
to TO O
server NN O
and CC O
server NN O
to TO O
client NN O
without IN O
regard NN O
to TO O
code VB O
pages NNS O
, , O
Gen NN O
1 CD O
samples NNS O
take VBP O
special JJ O
care NN O
to TO O
record VB O
the DT O
code NN O
page NN O
and CC O
locale NN O
information NN O
in IN O
each DT O
and CC O
every DT O
packet NN O
header NN O
that WDT O
traverses VBZ O
the DT O
divide NN O
between IN O
client NN O
and CC O
server NN O
and CC O
server NN O
and CC O
client NN O
. . O

This DT O
could MD O
indicate VB O
that IN O
the DT O
authors NNS O
of IN O
Gen NN O
1 CD O
understood VBN O
from IN O
an DT O
early JJ O
stage NN O
in IN O
the DT O
development NN O
of IN O
Gen NN O
1 CD O
that IN O
they PRP O
would MD O
be VB O
attacking VBG O
computer NN O
systems NNS O
with IN O
different JJ O
locales NNS O
and CC O
code NN O
pages NNS O
. . O

The DT B-Entity
Gen NN I-Entity
2 CD I-Entity
sub-family NN I-Entity
, , O
like IN O
Gen NN O
1.2 CD O
, , O
uses VBZ B-Action
a DT B-Entity
DLL NNP I-Entity
for IN B-Modifier
the DT B-Entity
core NN I-Entity
of IN I-Entity
its PRP$ I-Entity
RAT NN I-Entity
functionality NN I-Entity
. . O

In IN B-Modifier
order NN I-Modifier
for IN I-Modifier
the DT B-Entity
DLL NNP I-Entity
to TO I-Entity
load VB I-Entity
, , O
Gen NN B-Entity
2 CD I-Entity
( NN O
starting VBG O
with IN O
Gen NN O
2.1 CD O
) NN O
uses VBZ B-Action
a DT B-Entity
loader NN I-Entity
application NN I-Entity
( NN O
referred VBD O
to TO O
simply RB O
as IN O
'' '' O
the DT O
Loader NNP O
'' '' O
) NNP O
. . O

The DT O
Loader NNP O
comes VBZ O
in IN O
the DT O
form NN O
of IN O
a DT O
standard JJ O
executable JJ O
image NN O
or CC O
a DT O
DLL NNP O
image NN O
. . O

Despite IN O
the DT O
different JJ O
models NNS O
, , O
both DT B-Entity
variants NNS I-Entity
of IN I-Entity
the DT I-Entity
Loader NNP I-Entity
load VB B-Action
the DT B-Entity
embedded JJ I-Entity
DLL NNP I-Entity
in IN B-Modifier
the DT B-Entity
exact JJ I-Entity
same JJ I-Entity
way NN I-Entity
. . O

The DT O
only JJ O
difference NN O
between IN O
the DT O
executable JJ O
and CC O
DLL NNP O
versions NNS O
of IN O
the DT O
Loader NNP O
comes VBZ O
in IN O
how WRB O
they PRP O
handle VBP O
the DT O
initialization NN O
of IN O
the DT O
embedded JJ O
DLL NNP O
. . O

Figure NNP O
1 CD O
provides VBZ O
a DT O
side NN O
by IN O
side JJ O
comparison NN O
of IN O
the DT O
startup NN O
routines NNS O
for IN O
the DT O
executable JJ O
and CC O
DLL NNP O
Loaders NNPS O
. . O

Both DT B-Entity
versions NNS I-Entity
of IN I-Entity
the DT I-Entity
Loader NNP I-Entity
begin VB O
by IN O
loading VBG B-Action
the DT B-Entity
embedded JJ I-Entity
DLL NNP I-Entity
from IN B-Modifier
the DT B-Entity
Loader NNP I-Entity
's POS I-Entity
resources NNS I-Entity
( CD O
item NN O
102 CD O
under IN O
the DT O
Group NNP O
Icons NNP O
resource NN O
tree NN O
) NN O
, , O
decrypting VBG O
and CC O
decompressing VBG O
the DT O
image NN O
into IN O
memory NN O
, , O
then RB O
manually RB O
loading VBG B-Action
the DT B-Entity
DLL NNP I-Entity
into IN B-Modifier
memory NN B-Entity
using VBG B-Modifier
a DT B-Entity
custom NN I-Entity
loading VBG I-Entity
routine NN I-Entity
. . O

The DT O
function NN O
LoadEmbeddedImage NNP O
, , O
as IN O
seen VBN O
in IN O
part NN O
in IN O
Figure NNP O
2 CD O
, , O
is VBZ O
responsible JJ O
for IN O
this DT O
operation NN O
. . O

The DT O
Loader NNP O
obfuscates VBZ O
many JJ O
strings NNS O
by IN O
using VBG O
a DT O
simple JJ O
XOR NN O
encoding NN O
scheme NN O
. . O

Decryption NN O
of IN O
encoded VBN O
strings NNS O
consists VBZ O
of IN O
taking VBG O
the DT O
first JJ O
value NN O
of IN O
the DT O
string NN O
as IN O
the DT O
XOR NN O
key NN O
, , O
XOR'ing VBG O
all DT O
subsequent JJ O
bytes NNS O
until IN O
the DT O
result NN O
of IN O
the DT O
XOR NN O
returns NNS O
0 CD O
. . O

The DT O
decoding NN O
of IN O
the DT O
encoded VBN O
strings NNS O
is VBZ O
handled VBN O
by IN O
the DT O
DecodeString NN O
function NN O
. . O

The DT O
Loader NNP O
stores VBZ O
the DT O
embedded JJ O
DLL NN O
within IN O
a DT O
Group NNP O
Icon NNP O
resource NN O
within IN O
a DT O
legitimate JJ O
icon NN O
image NN O
. . O

In IN O
order NN O
to TO O
locate VB O
the DT O
embedded JJ O
DLL NNP O
, , O
LoadEmbeddedImage NNP O
will MD O
use VB O
the DT O
DecodeString NNP O
function NN O
to TO O
decrypt VB O
the DT O
delimiter NN O
string NN O
( NN O
which WDT O
is VBZ O
typically RB O
zzzzzzzzzz JJ O
or CC O
yyyyyyyyyy JJ O
) NN O
and CC O
then RB O
search VB O
the DT O
icon's JJ O
resource NN O
memory NN O
for IN O
the DT O
delimiter NN O
string NN O
. . O

Once RB O
located JJ O
, , O
LoadEmbeddedImage NNP O
will MD O
use VB O
the DT O
first JJ O
12 CD O
bytes NNS O
immediately RB O
after IN O
the DT O
string NN O
as IN O
the DT O
information NN O
structure NN O
about IN O
the DT O
embedded JJ O
DLL NNP O
. . O

The DT O
structure NN O
( NN O
seen VBN O
below IN O
) NN O
defines VBZ O
the DT O
size NN O
of IN O
the DT O
embedded JJ O
DLL NN O
within IN O
the DT O
icon NN O
's POS O
resource NN O
memory NN O
, , O
the DT O
size NN O
of IN O
the DT O
DLL NNP O
after IN O
it PRP O
is VBZ O
decompressed VBN O
and CC O
a DT O
4-byte JJ O
XOR NN O
key NN O
that IN O
LoadEmbeddedImage NNP O
must MD O
use VB O
to TO O
decode VB O
the DT O
embedded JJ O
DLL NNP O
prior RB O
to TO O
decompression NN O
. . O

LoadEmbeddedImage NN B-Entity
copies NNS B-Action
the DT B-Entity
compressed VBN I-Entity
embedded JJ I-Entity
DLL NNP I-Entity
into IN B-Modifier
a DT B-Entity
newly RB I-Entity
allocated VBN I-Entity
heap NN I-Entity
buffer NN I-Entity
and CC O
then RB O
calls VBZ B-Action
the DT B-Entity
function NN I-Entity
decodeBuffer NN I-Entity
( NN I-Entity
using VBG I-Entity
the DT I-Entity
EncodingKey NNP I-Entity
value NN I-Entity
) NN I-Entity
to TO B-Modifier
decrypt VB B-Entity
the DT I-Entity
embedded JJ I-Entity
DLL NNP I-Entity
. . O

Another DT O
heap NN O
buffer NN O
is VBZ O
allocated VBN O
with IN O
a DT O
size NN O
equal JJ O
to TO O
the DT O
value NN O
of IN O
dwImageSizeDecompressed NN O
. . O

The DT O
decompression NN O
buffer NN O
along IN O
with IN O
the DT O
now RB O
decoded VBN O
compressed VBN O
buffer NN O
are VBP O
given VBN O
to TO O
lzodecompress NN O
which WDT O
decompresses VBZ O
the DT O
compressed VBN O
image NN O
using VBG O
the DT O
LZO1X NN O
algorithm NN O
. . O

With IN O
the DT O
embedded JJ O
DLL NNP O
now RB O
decompressed VBN O
into IN O
a DT O
heap NN O
buffer NN O
, , O
LoadEmbeddedImage NNP B-Entity
calls VBZ B-Action
ImageLoaderData NNP B-Entity
: : I-Entity
:LoadDll NN I-Entity
to TO O
manually RB O
load VB B-Action
the DT B-Entity
DLL NNP I-Entity
into IN B-Modifier
memory NN B-Entity
. . O

ImageLoaderData NNP B-Entity
: : I-Entity
:LoadDll NN I-Entity
interprets VBZ O
the DT O
PE/COFF NN O
header NN O
of IN O
the DT O
DLL NNP O
image NN O
, , O
loads NNS B-Action
the DT B-Entity
image NN I-Entity
into IN B-Modifier
the DT B-Entity
appropriate JJ I-Entity
memory NN I-Entity
configuration NN I-Entity
, , O
performs VBZ O
the DT O
necessary JJ O
relocation NN O
operations NNS O
, , O
and CC O
calls VBZ B-Action
the DT B-Entity
DllMain NNP I-Entity
( NNP I-Entity
DLL NNP I-Entity
's POS I-Entity
entry NN I-Entity
point NN I-Entity
) NN I-Entity
function NN I-Entity
. . O

After IN O
loading VBG B-Action
the DT B-Entity
embedded JJ I-Entity
DLL NNP I-Entity
image NN I-Entity
into IN B-Modifier
memory NN B-Entity
, , O
the DT B-Entity
Loader NNP I-Entity
will MD O
either RB O
call VB B-Action
the DT B-Entity
DLL's NNP I-Entity
StartServer NNP I-Entity
or CC I-Entity
MatrixMain NNP I-Entity
function NN I-Entity
depending VBG O
on IN O
the DT O
type NN O
of IN O
Loader NNP O
. . O

The DT B-Entity
standalone JJ I-Entity
Loaders NNS I-Entity
use VBP B-Action
the DT B-Entity
MatrixMain NNP I-Entity
function NN I-Entity
while IN O
the DT B-Entity
DLL NNP I-Entity
Loaders NNP I-Entity
will MD O
call VB B-Action
the DT B-Entity
StartServer NNP I-Entity
function NN I-Entity
. . O

The DT B-Entity
Loaders NNP I-Entity
, , O
upon IN B-Modifier
unloading VBG B-Entity
, , O
will MD O
call VB B-Action
the DT B-Entity
StopServer NNP I-Entity
function NN I-Entity
in IN B-Modifier
order NN I-Modifier
to TO I-Modifier
shut VB B-Entity
down RP I-Entity
the DT I-Entity
embedded JJ I-Entity
DLL NNP I-Entity
. . O

The DT O
Gen NN O
2 CD O
DLL NNP O
exposes VBZ O
five CD O
exported VBN O
functions NNS O
( VBP O
besides IN O
the DT O
DllEntryPoint/DllMain NNP O
) NNP O
. . O

MatrixMain NNP B-Entity
and CC I-Entity
StartServer NNP I-Entity
both DT O
ultimately RB O
generate VB B-Action
a DT B-Entity
new JJ I-Entity
thread NN I-Entity
( NN O
using VBG B-Modifier
the DT B-Entity
POSIX NNP I-Entity
API NNP I-Entity
function NN I-Entity
beginthreadex NN I-Entity
instead RB B-Modifier
of IN I-Modifier
the DT B-Entity
more RBR I-Entity
common JJ I-Entity
CreateThread NNP I-Entity
) NN O
that WDT O
contains VBZ O
the DT O
main JJ O
loop NN O
of IN O
the DT O
Gen NN O
2 CD O
RAT NN O
functionality NN O
. . O

MatrixMain NNP O
, , O
however RB O
, , O
has VBZ O
added VBN O
functionality NN O
. . O

The DT O
prototype NN O
for IN O
MatrixMain NNP O
is VBZ O
as IN O
follows VBZ O
: : O
where WRB O
Arguments NNS O
parameter NN O
can MD O
be VB O
: : O
If IN O
the DT O
i FW O
parameter NN O
is VBZ O
given VBN O
, , O
the DT B-Entity
DLL NNP I-Entity
will MD O
install VB B-Action
itself PRP B-Entity
as IN B-Modifier
a DT B-Entity
service NN I-Entity
on IN B-Modifier
the DT B-Entity
victim NN I-Entity
's POS I-Entity
machine NN I-Entity
. . O

The DT B-Entity
DLL NNP I-Entity
will MD O
create VB B-Action
a DT B-Entity
new JJ I-Entity
service NN I-Entity
( FW O
e.g FW O
. . O

'' '' O
Network NNP O
DDE NNP O
Service NNP O
'' '' O
) NN O
and CC O
assign VB O
itself PRP O
as IN O
the DT O
executable JJ O
for IN O
the DT O
service NN O
. . O

The DT B-Entity
DLL NNP I-Entity
's POS I-Entity
RAT NN I-Entity
functionality NN I-Entity
provides VBZ B-Action
basic JJ O
features NNS O
such JJ O
as IN O
network NN O
port NN O
forwarding NN O
( FW O
proxying FW O
) NN O
, , O
file NN O
transfer NN O
, , O
and CC O
remote JJ B-Entity
command NN I-Entity
shell NN I-Entity
. . O

The DT O
RAT NN O
functionality NN O
provides VBZ O
an DT O
attacker NN O
with IN O
the DT O
ability NN O
to TO O
establish VB O
a DT O
phantom JJ O
network NN O
within IN O
a DT O
victim NN O
's POS O
infrastructure NN O
by IN O
having VBG O
individual JJ B-Entity
instances NNS I-Entity
of IN I-Entity
Gen NN I-Entity
2 CD I-Entity
DLL NNP I-Entity
listen VB B-Action
for IN B-Modifier
incoming JJ B-Entity
connections NNS I-Entity
on IN B-Modifier
local JJ B-Entity
ports NNS I-Entity
( VBP O
presumably RB O
, , O
NAT NNP O
'd NNP O
ports NNS O
) VBP O
and CC O
accept VBP B-Action
commands NNS B-Entity
from IN B-Modifier
the DT B-Entity
inbound JJ I-Entity
connection NN I-Entity
. . O

This DT O
allows VBZ O
an DT O
attacker NN O
to TO O
establish VB O
several JJ O
Gen2 NN O
infections NNS O
within IN O
a DT O
victim's NN O
infrastructure NN O
and CC O
if IN O
outbound JJ O
connectivity NN O
is VBZ O
prohibited VBN O
for IN O
any DT O
of IN O
the DT O
infected JJ O
machines NNS O
, , O
the DT O
attacker NN O
can MD O
route NN O
commands NNS O
to TO O
the DT O
pseudo-isolated JJ O
infections NNS O
through IN O
accessible JJ O
infected JJ O
machines NNS O
providing VBG B-Action
a DT B-Entity
high JJ I-Entity
level NN I-Entity
of IN I-Entity
persistence NN I-Entity
to TO B-Modifier
the DT B-Entity
malware NN I-Entity
. . O

Each DT B-Entity
Gen NN I-Entity
2 CD I-Entity
infection NN I-Entity
can MD O
support VB B-Action
up IN B-Modifier
to TO I-Modifier
10 CD B-Entity
listening NN I-Entity
ports NNS I-Entity
. . O

The DT B-Entity
communication NN I-Entity
between IN I-Entity
the DT I-Entity
Gen NN I-Entity
2 CD I-Entity
malware NN I-Entity
and CC I-Entity
the DT I-Entity
C2 NN I-Entity
( NN O
or CC O
other JJ O
Gen NN O
2 CD O
malware NN O
, , O
in IN O
the DT O
case NN O
of IN O
the DT O
internal JJ O
routing VBG O
functionality NN O
) NN O
is VBZ B-Action
encrypted VBN I-Action
using VBG B-Modifier
a DT B-Entity
simple JJ I-Entity
DWORD NN I-Entity
XOR NN I-Entity
scheme NN I-Entity
. . O

Each DT O
communication NN O
burst NN O
( NN O
either CC O
between IN O
the DT O
malware NN O
and CC O
the DT O
C2 NN O
or CC O
the DT O
malware NN O
and CC O
neighboring JJ O
malware NN O
) NN O
begins VBZ O
with IN O
a DT O
24-byte JJ O
header NN O
identical JJ O
to TO O
the DT O
header NN O
found VBN O
in IN O
Gen NN O
1.2 CD O
. . O

Immediately RB O
following VBG O
the DT O
header NN O
is VBZ O
the DT O
type-specific JJ O
( NN O
as IN O
indicated VBN O
by IN O
the DT O
dwPayloadType NN O
field NN O
) CD O
payload NN O
data NNS O
. . O

Note VB O
that IN O
the DT O
dwXORKey NN O
value NN O
is VBZ O
NOT RB O
encoded VBN O
with IN O
the DT O
XOR NN O
value NN O
, , O
but CC O
rather RB O
is VBZ O
the DT O
value NN O
that WDT O
is VBZ O
used VBN O
for IN O
encoding VBG O
the DT O
header NN O
and CC O
payload NN O
. . O

Each DT O
DLL NNP O
includes VBZ O
a DT O
hardcoded NN O
, , O
default NN O
configuration NN O
. . O

At IN O
the DT O
time NN O
that IN O
the DT O
RAT NN O
functionality NN O
activates VBZ O
, , O
the DT O
DLL NNP O
will MD O
drop VB O
the DT O
current JJ O
configuration NN O
to TO O
disk NN O
. . O

If IN O
the DT O
configuration NN O
file NN O
already RB O
exists VBZ O
, , O
then RB O
the DT O
RAT NN O
will MD O
use VB O
the DT O
file NN O
version NN O
of IN O
the DT O
configuration NN O
over IN O
the DT O
default NN O
configuration NN O
. . O

The DT O
configuration NN O
data NN O
structure NN O
( NN O
seen VBN O
below IN O
) NN O
doubles VBZ O
as IN O
a DT O
current JJ O
state NN O
record NN O
for IN O
some DT O
aspects NNS O
of IN O
the DT O
communication NN O
subsystem NN O
of IN O
the DT O
DLL NNP O
. . O

When WRB O
stored VBN O
on IN O
disk NN O
, , O
the DT O
configuration NN O
is VBZ O
preceded VBN O
by IN O
a DT O
GUID NN O
value NN O
( NN O
16 CD O
bytes NNS O
) NN O
that WDT O
represents VBZ O
the DT O
unique JJ O
identifier NN O
for IN O
the DT O
specific JJ O
infection NN O
. . O

The DT O
configuration NN O
is VBZ O
XOR NNP O
encoded VBN O
using VBG O
the DT O
first JJ O
4 CD O
bytes FW O
( FW O
as IN O
a DT O
DWORD FW O
) FW O
of IN O
the DT O
GUID NN O
. . O

In IN O
order NN O
to TO O
provide VB O
some DT O
level NN O
of IN O
stealth NN O
, , O
the DT B-Entity
RAT NN I-Entity
will MD O
install VB B-Action
a DT B-Entity
rootkit NN I-Entity
on IN B-Modifier
32-bit JJ B-Entity
versions NNS I-Entity
of IN I-Entity
Windows NNP I-Entity
. . O

The DT O
DLL NNP O
contains VBZ O
a DT O
device NN O
driver NN O
image NN O
embedded VBN O
within IN O
an DT O
encoded VBN O
buffer NN O
which WDT O
the DT O
RAT NN O
functionality NN O
code NN O
will MD O
extract VB O
to TO O
the DT O
% NN O
TEMP NN O
% NN O
directory NN O
( NN O
after IN O
XOR'ing VBG O
the DT O
buffer NN O
with IN O
0x76 FW O
) FW O
. . O

To TO O
activate VB O
the DT O
rootkit NN O
, , O
the DT B-Entity
RAT NN I-Entity
functionality NN I-Entity
code NN I-Entity
creates VBZ B-Action
a DT B-Entity
service NN I-Entity
with IN B-Modifier
the DT B-Entity
driver NN I-Entity
in IN I-Entity
the DT I-Entity
% NN I-Entity
TEMP NN I-Entity
% NN I-Entity
directory NN I-Entity
as IN I-Entity
the DT I-Entity
executable JJ I-Entity
for IN I-Entity
the DT I-Entity
service NN I-Entity
. . O

The DT B-Entity
RAT NN I-Entity
functionality NN I-Entity
code NN I-Entity
then RB O
activates VBZ B-Action
the DT B-Entity
service NN I-Entity
and CC O
opens VBZ O
a DT O
handle VB O
to TO O
device NN O
driver NN O
's POS O
interface NN O
( FW O
e.g FW O
. . O

\Globals\HTTPS FW O
) FW O
. . O

With IN O
the DT O
handle VBP O
open JJ O
to TO O
the DT O
rootkit NN O
driver NN O
, , O
the DT B-Entity
RAT NN I-Entity
functionality NN I-Entity
code NN I-Entity
deletes VBZ B-Action
the DT B-Entity
service NN I-Entity
in IN B-Modifier
order NN I-Modifier
to TO I-Modifier
reduce VB B-Entity
the DT I-Entity
visible JJ I-Entity
footprint NN I-Entity
of IN I-Entity
the DT I-Entity
new JJ I-Entity
driver NN I-Entity
. . O

To TO O
further RB O
reduce VB O
the DT O
footprint NN O
of IN O
the DT O
driver NN O
, , O
the DT B-Entity
RAT NN I-Entity
functionality NN I-Entity
code NN I-Entity
also RB O
uses VBZ O
the DT O
cloaking VBG O
functionality NN O
of IN O
the DT O
rootkit NN O
to TO O
hide VB B-Action
the DT B-Entity
DLL NNP I-Entity
's POS I-Entity
PID NNP I-Entity
, , O
any DT O
references NNS O
to TO O
the DT O
GUID NNP O
{ NNP O
4AE26357-79A3-466D-A6D9- NNP O
FC38BFB67DEA NNP O
} NNP O
, , O
the DT B-Entity
DLL NNP I-Entity
's POS I-Entity
service NN I-Entity
names NNS I-Entity
( FW I-Entity
e.g FW I-Entity
. . I-Entity
'' '' I-Entity
NetDDESrv NNP I-Entity
'' '' I-Entity
and CC I-Entity
'' '' I-Entity
Network NNP I-Entity
DDE NNP I-Entity
Service NNP I-Entity
'' '' I-Entity
) NN I-Entity
and CC I-Entity
the DT I-Entity
service NN I-Entity
entry NN I-Entity
as RB I-Entity
well RB I-Entity
. . O

Additionally RB O
, , O
the DT B-Entity
code NN I-Entity
also RB O
attempts VBZ O
to TO O
hide VB B-Action
a DT B-Entity
service NN I-Entity
named VBN I-Entity
'' '' I-Entity
Hitx NNP I-Entity
'' '' I-Entity
. . O

In IN O
addition NN O
to TO O
the DT O
main JJ O
Hikit FW O
malware FW O
, , O
there EX O
are VBP O
at IN O
least JJS O
two CD O
examples NNS O
of IN O
support NN O
programs NNS O
that WDT O
belong VBP O
to TO O
the DT O
Hikit NN O
family NN O
. . O

Samples NNS O
b04de6c417b6f8836e3f2d8822be2e68f4f9722b NN O
and CC O
7c4da9deff3e5c7611b9e1bd67d0e74aa7d2d0f6 NN O
are VBP O
examples NNS O
of IN O
Gen NN O
1.0 CD O
and CC O
Gen NN O
1.2 CD O
operator NN O
consoles VBZ O
. . O

The DT B-Entity
console NN I-Entity
is VBZ O
a DT O
text NN O
based JJ O
application NN O
that WDT O
takes VBZ O
a DT O
Gen NN O
1.0 CD O
or CC O
Gen NN O
1.2 CD O
infection NN O
's POS O
IP NNP O
address NN O
and CC O
proceeds NNS O
to TO O
connect VB B-Action
and CC I-Action
authenticate VB I-Action
with IN B-Modifier
the DT B-Entity
infected JJ I-Entity
server NN I-Entity
. . O

Once RB O
connected VBN O
, , O
the DT B-Entity
operator NN I-Entity
has VBZ B-Action
the DT B-Entity
basic JJ I-Entity
Hikit NN I-Entity
functionalities NNS I-Entity
available JJ I-Entity
to TO I-Entity
them PRP I-Entity
via IN B-Modifier
commands NNS B-Entity
such JJ I-Entity
as IN I-Entity
file NN I-Entity
and CC I-Entity
shell NN I-Entity
. . O

Detecting VBG O
Hikit JJ O
variants NNS O
on IN O
disk NN O
and CC O
in IN O
memory NN O
is VBZ O
possible JJ O
using VBG O
the DT O
following VBG O
YARA NN O
signature NN O
developed VBN O
by IN O
Symantec NNP O
: : O
Detecting VBG O
nominal JJ O
Gen NN O
1.2 CD O
and CC O
later JJ O
network NN O
activity NN O
is VBZ O
problematic JJ O
given VBN O
the DT O
nature NN O
of IN O
the DT O
communication NN O
structure NN O
. . O

The DT O
encrypted JJ O
nature NN O
of IN O
the DT O
nominal JJ O
Gen NN O
1.2 CD O
and CC O
later JJ O
network NN O
traffic NN O
makes VBZ O
a DT O
signature NN O
difficult JJ O
. . O

Snort VB O
signature NN O
30948 CD O
may MD O
detect VB O
some DT O
Hikit NNP O
based VBN O
network NN O
traffic NN O
for IN O
only JJ O
Gen NN O
1.0 CD O
and CC O
Gen NN O
1.1 CD O
. . O

From IN O
a DT O
system NN O
objects NNS O
perspective NN O
, , O
Gen NN B-Entity
2 CD I-Entity
samples NNS I-Entity
produce VBP B-Action
up IN B-Modifier
to TO I-Modifier
three CD B-Entity
named VBN I-Entity
events NNS I-Entity
. . O

The DT O
event NN O
names NNS O
change VBP O
per IN O
infection NN O
, , O
but CC O
have VBP O
a DT O
common JJ O
format NN O
. . O

The DT O
following JJ O
three CD O
strings NNS O
represent VBP O
the DT O
known JJ O
mutex NN O
strings NNS O
for IN O
Gen NN O
2 CD O
samples NNS O
: : O
where WRB O
the DT O
% NN O
s NN O
format NN O
variable NN O
is VBZ O
replaced VBN O
with IN O
a DT O
UUID NN O
value NN O
string NN O
specific JJ O
to TO O
the DT O
infected JJ O
machine. NN O
